<<<<<<< HEAD
<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Bingoh&#39;s blog by Rlilyyy</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Bingoh&#39;s blog</h1>
        <h2>渐行渐远·Never give up</h2>
        <a href="https://github.com/Rlilyyy" class="button"><small>Follow me on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a id="双飞翼布局和圣杯布局" class="anchor" href="#%E5%8F%8C%E9%A3%9E%E7%BF%BC%E5%B8%83%E5%B1%80%E5%92%8C%E5%9C%A3%E6%9D%AF%E5%B8%83%E5%B1%80" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>双飞翼布局和圣杯布局</h1>

<p>双飞翼布局源自淘宝UED，圣杯布局来自2006年 Matthew Levine 的一篇文章，目的都是为了实现三列布局（中间列自适应宽度，两边分别固定宽度），并且中间列优先加载。两种布局的原理可以应用到两列布局中。</p>

<p>开始之前说一个翻译问题，圣杯布局作者提到发明圣杯布局前的其中一个需求：<code>allow any column to be the tallest</code>
这里应该翻译为：允许任意列高度是最高的，而不是“允许任意列（在 HTML 中位置）在最高”。</p>

<p>相同点：</p>

<ul>
<li>都让三列布局左浮动</li>
<li>实现三列布局</li>
<li>中间列优先加载</li>
<li>左右两列顺序不影响布局</li>
</ul>

<p>异同点：</p>

<ul>
<li>圣杯布局利用布局父元素 container 左右 padding 出边距给予左右两列的空间放置，左右两列则通过 position 和margin 负边距插入到自身的位置。</li>
<li>双飞翼布局直接在 container 加入一个 div 包裹住中间列，同时该 div 浮动，而被包裹住的中间列则 margin 左右为左右两列布局留出空白，这样做省了多个 CSS 属性（position，左右两列的 margin 负边距，container 的 padding 属性，左右两列的 left 或 right 属性），但是双飞翼则多了一个 div 标签。</li>
<li>圣杯布局在 IE 6/7 下需要加入 hack 解决一个布局问题，双飞翼布局则不用。</li>
</ul>

<p>在我看来我更喜欢双飞翼布局，用一个 div 标签换来减少多个属性和一个 hack 属性（在 IE 6/7 下圣杯布局需要加入 hack，但是如果 container 触发了 BFC 则该 hack 不用加入，例如 container 使用了 clearfix 或 overflow: hidden）。圣杯布局下需要加入的 hack 是左边的列的 left 属性必须是右边列的宽度的值，在正常浏览器布局下 left 属性的值则是自身的宽度的负值，这里提一个现象，在实现圣杯布局的时候我使用了 clearfix 闭合浮动而不是圣杯布局来源文章中的使用 footer 来清除浮动，导致在 IE 6/7 下会出现的异常布局消失了，我估计是触发了 BFC 的原因（我把 clearfix 去掉后使用了 overflow: hidden 出现同样的效果）。</p>

<h2>
<a id="1双飞翼布局" class="anchor" href="#1%E5%8F%8C%E9%A3%9E%E7%BF%BC%E5%B8%83%E5%B1%80" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1.双飞翼布局</h2>

<p>演示地址：<a href="http://www.libinhong.com/demo/Flying">http://www.libinhong.com/demo/Flying</a></p>

<h3>
<a id="css" class="anchor" href="#css" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>CSS：</h3>

<div class="highlight highlight-source-css"><pre><span class="pl-ent">body</span> {
    <span class="pl-c1"><span class="pl-c1">margin</span></span>: <span class="pl-c1">0</span>;
    <span class="pl-c1"><span class="pl-c1">padding</span></span>: <span class="pl-c1">0</span>;
    <span class="pl-c1"><span class="pl-c1">text-align</span></span>: <span class="pl-c1">center</span>;
    <span class="pl-c1"><span class="pl-c1">font-family</span></span>: Microsoft YaHei;
}

<span class="pl-e">.fl</span> {
    <span class="pl-c1"><span class="pl-c1">float</span></span>: <span class="pl-c1">left</span>;
    <span class="pl-c1"><span class="pl-c1">height</span></span>: <span class="pl-c1">300<span class="pl-k">px</span></span>;
}

<span class="pl-e">.container-center</span> {
    <span class="pl-c1"><span class="pl-c1">width</span></span>: <span class="pl-c1">100<span class="pl-k">%</span></span>;
}

<span class="pl-e">.container-center</span> <span class="pl-e">.center</span> {
    <span class="pl-c1"><span class="pl-c1">margin</span></span>: <span class="pl-c1">0</span> <span class="pl-c1">200<span class="pl-k">px</span></span>;
    <span class="pl-c1"><span class="pl-c1">height</span></span>: <span class="pl-c1">100<span class="pl-k">%</span></span>;
    <span class="pl-c1"><span class="pl-c1">background-color</span></span>: <span class="pl-c1">rgb</span>(<span class="pl-c1">143, 221, 172</span>);
}

<span class="pl-e">.container</span> <span class="pl-e">.left</span> {
    <span class="pl-c1"><span class="pl-c1">width</span></span>: <span class="pl-c1">200<span class="pl-k">px</span></span>;
    <span class="pl-c1"><span class="pl-c1">margin-left</span></span>: <span class="pl-c1">-100<span class="pl-k">%</span></span>;
    <span class="pl-c1"><span class="pl-c1">background</span></span>: <span class="pl-c1">rgb</span>(<span class="pl-c1">205, 228, 128</span>);
}

<span class="pl-e">.container</span> <span class="pl-e">.right</span> {
    <span class="pl-c1"><span class="pl-c1">width</span></span>: <span class="pl-c1">200<span class="pl-k">px</span></span>;
    <span class="pl-c1"><span class="pl-c1">margin-left</span></span>: <span class="pl-c1">-200<span class="pl-k">px</span></span>;
    <span class="pl-c1"><span class="pl-c1">background-color</span></span>: <span class="pl-c1">rgb</span>(<span class="pl-c1">94, 152, 185</span>);
}

<span class="pl-e">.clearfix</span><span class="pl-e">:before</span>, <span class="pl-e">.clearfix</span><span class="pl-e">:after</span> {
    <span class="pl-c1"><span class="pl-c1">content</span></span>: <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>;
    <span class="pl-c1"><span class="pl-c1">display</span></span>: table;
}
<span class="pl-e">.clearfix</span><span class="pl-e">:after</span> {
    <span class="pl-c1"><span class="pl-c1">clear</span></span>: <span class="pl-c1">both</span>;
}
<span class="pl-e">.clearfix</span> {
    *<span class="pl-c1"><span class="pl-c1">zoom</span></span>: <span class="pl-c1">1</span>;
}</pre></div>

<h3>
<a id="html" class="anchor" href="#html" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>HTML：</h3>

<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>container clearfix<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>container-center fl<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>center<span class="pl-pds">"</span></span>&gt;中间自适应&lt;/<span class="pl-ent">div</span>&gt;
    &lt;/<span class="pl-ent">div</span>&gt;
    &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>left fl<span class="pl-pds">"</span></span>&gt;左边固定200px&lt;/<span class="pl-ent">div</span>&gt;
    &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>right fl<span class="pl-pds">"</span></span>&gt;右边固定200px&lt;/<span class="pl-ent">div</span>&gt;
&lt;/<span class="pl-ent">div</span>&gt;</pre></div>

<h2>
<a id="2圣杯布局" class="anchor" href="#2%E5%9C%A3%E6%9D%AF%E5%B8%83%E5%B1%80" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2.圣杯布局</h2>

<p>演示地址：<a href="http://www.libinhong.com/demo/HolyGrails">http://www.libinhong.com/demo/HolyGrails</a></p>

<h3>
<a id="css-1" class="anchor" href="#css-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>CSS：</h3>

<div class="highlight highlight-source-css"><pre><span class="pl-ent">body</span> {
    <span class="pl-c1"><span class="pl-c1">margin</span></span>: <span class="pl-c1">0</span>;
    <span class="pl-c1"><span class="pl-c1">padding</span></span>: <span class="pl-c1">0</span>;
    <span class="pl-c1"><span class="pl-c1">text-align</span></span>: <span class="pl-c1">center</span>;
    <span class="pl-c1"><span class="pl-c1">font-family</span></span>: Microsoft YaHei;
}

<span class="pl-e">.fl</span> {
    <span class="pl-c1"><span class="pl-c1">float</span></span>: <span class="pl-c1">left</span>;
    <span class="pl-c1"><span class="pl-c1">height</span></span>: <span class="pl-c1">300<span class="pl-k">px</span></span>;
    <span class="pl-c1"><span class="pl-c1">position</span></span>: <span class="pl-c1">relative</span>;
}

<span class="pl-e">.container</span> {
    <span class="pl-c1"><span class="pl-c1">padding</span></span>: <span class="pl-c1">0</span> <span class="pl-c1">200<span class="pl-k">px</span></span> <span class="pl-c1">0</span> <span class="pl-c1">150<span class="pl-k">px</span></span>;
}

<span class="pl-e">.container</span> <span class="pl-e">.center</span> {
    <span class="pl-c1"><span class="pl-c1">width</span></span>: <span class="pl-c1">100<span class="pl-k">%</span></span>;
    <span class="pl-c1"><span class="pl-c1">background-color</span></span>: <span class="pl-c1">rgb</span>(<span class="pl-c1">166, 212, 121</span>);
}
<span class="pl-e">.container</span> <span class="pl-e">.left</span> {
    <span class="pl-c1"><span class="pl-c1">width</span></span>: <span class="pl-c1">150<span class="pl-k">px</span></span>;
    <span class="pl-c1"><span class="pl-c1">margin-left</span></span>: <span class="pl-c1">-100<span class="pl-k">%</span></span>;
    <span class="pl-c1"><span class="pl-c1">left</span></span>: <span class="pl-c1">-150<span class="pl-k">px</span></span>;
    <span class="pl-c">/**left: 200px;*/</span>  <span class="pl-c">/** for IE6/7*/</span>*/
    <span class="pl-c1"><span class="pl-c1">background-color</span></span>: <span class="pl-c1">rgb</span>(<span class="pl-c1">136, 204, 194</span>);
}

<span class="pl-e">.container</span> <span class="pl-e">.right</span> {
    <span class="pl-c1"><span class="pl-c1">width</span></span>: <span class="pl-c1">200<span class="pl-k">px</span></span>;
    <span class="pl-c1"><span class="pl-c1">margin-right</span></span>: <span class="pl-c1">-200<span class="pl-k">px</span></span>;
    <span class="pl-c1"><span class="pl-c1">background-color</span></span>: <span class="pl-c1">rgb</span>(<span class="pl-c1">228, 215, 92</span>);
}

<span class="pl-e">.clearfix</span><span class="pl-e">:before</span>, <span class="pl-e">.clearfix</span><span class="pl-e">:after</span> {
    <span class="pl-c1"><span class="pl-c1">content</span></span>: <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>;
    <span class="pl-c1"><span class="pl-c1">display</span></span>: table;
}
<span class="pl-e">.clearfix</span><span class="pl-e">:after</span> {
    <span class="pl-c1"><span class="pl-c1">clear</span></span>: <span class="pl-c1">both</span>;
}
<span class="pl-e">.clearfix</span> {
    *<span class="pl-c1"><span class="pl-c1">zoom</span></span>: <span class="pl-c1">1</span>;
}</pre></div>

<h3>
<a id="html-1" class="anchor" href="#html-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>HTML：</h3>

<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>container clearfix<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>center fl<span class="pl-pds">"</span></span>&gt;中间自适应&lt;/<span class="pl-ent">div</span>&gt;
    &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>left fl<span class="pl-pds">"</span></span>&gt;左边固定150px&lt;/<span class="pl-ent">div</span>&gt;
    &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>right fl<span class="pl-pds">"</span></span>&gt;右边固定200px&lt;/<span class="pl-ent">div</span>&gt;
&lt;/<span class="pl-ent">div</span>&gt;</pre></div>
        </section>

        <aside id="sidebar">


          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
=======
<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="滨滨和泓泓" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="滨滨和泓泓">
<meta property="og:url" content="http://rlilyyy.github.io/index.html">
<meta property="og:site_name" content="滨滨和泓泓">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="滨滨和泓泓">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 6263065978234471000,
      author: '博主'
    }
  };
</script>

  <title> 滨滨和泓泓 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-75726349-1', 'auto');
  ga('send', 'pageview');
</script>









  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">滨滨和泓泓</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">我被外星飞船劫走了，被逼着学前端</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-fuli">
          <a href="http://www.libinhong.com:5000" rel="section">
            
              <i class="menu-item-icon fa fa-gift fa-fw"></i> <br />
            
            福利
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/02/CSS-Level-4-中的新东西/" itemprop="url">
                  CSS Selectors Level 4 中的新东西
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-02T21:25:50+08:00" content="2016-10-02">
              2016-10-02
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/前端/CSS-Selectors-Level-4/" itemprop="url" rel="index">
                    <span itemprop="name">CSS Selectors Level 4</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/前端/CSS-Selectors-Level-4/CSS4/" itemprop="url" rel="index">
                    <span itemprop="name">CSS4</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/02/CSS-Level-4-中的新东西/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/02/CSS-Level-4-中的新东西/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>以下所有示例在 <code>Safari Technology Preview</code> 饮用最佳，<code>Chrome Canary</code> 有些示例都还没实现，可能是我使用的姿势不对……</p>
</blockquote>
<h1 id="Negation-pseudo-class——-not"><a href="#Negation-pseudo-class——-not" class="headerlink" title="Negation pseudo-class——:not()"></a>Negation pseudo-class——:not()</h1><blockquote>
<p><code>:not()</code> 伪类用于将符合规则的元素剔除，将样式规则应用于其他元素上。在 CSS3 中已经有 <code>:not()</code> 伪类，不过在 CSS3 中只能使用简单的匹配规则，例如 <code>:not(p)</code> 用来选择不是 <code>&lt;p&gt;&lt;/p&gt;</code> 的元素。而在 CSS4 中，可以应用更复杂的匹配规则，但是同样地不允许嵌套使用，例如 <code>:not(:not(...))</code>。</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.negation</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.negation</span> <span class="selector-class">.default</span><span class="selector-pseudo">:not(</span><span class="selector-attr">[data-red="no"]</span>) &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.negation</span> <span class="selector-class">.default</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.negation</span> <span class="selector-class">.default</span> <span class="selector-tag">a</span><span class="selector-pseudo">:not(</span><span class="selector-attr">[rel="green"]</span>, <span class="selector-attr">[rel="default"]</span>) &#123;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"negation"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"default"</span> <span class="attr">data-red</span>=<span class="string">"no"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.baidu.com"</span> <span class="attr">rel</span>=<span class="string">"green"</span>&gt;</span>这里是绿色<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.ele.me"</span> <span class="attr">rel</span>=<span class="string">"default"</span>&gt;</span>这里也是绿色<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.sina.com"</span> <span class="attr">rel</span>=<span class="string">"blue"</span>&gt;</span>这里是蓝色<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"default"</span> <span class="attr">data-red</span>=<span class="string">"no"</span>&gt;</span></span><br><span class="line">    这里是黑色</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"default"</span> <span class="attr">data-red</span>=<span class="string">"yes"</span>&gt;</span></span><br><span class="line">    这里是红色</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="not-tips"><a href="#not-tips" class="headerlink" title=":not() tips"></a><code>:not()</code> tips</h2><p>我们可以利用 <code>:not()</code> 来对 CSS 样式进行一个优先级提升，例如 <code>div:not(span) {…}</code> 跟 <code>div {…}</code> 是同个概念，但是明显地前者的优先级更高。</p>
<blockquote>
<p>想解锁更多 <code>:not()</code> 的使用姿势就去看 <a href="https://www.w3.org/TR/2013/WD-selectors4-20130502/#negation" target="_blank" rel="external">The Negation Pseudo-class 草案</a>。</p>
</blockquote>
<h1 id="Matches-any-Pseudo-class——-matches-伪类"><a href="#Matches-any-Pseudo-class——-matches-伪类" class="headerlink" title="Matches-any Pseudo-class——:matches 伪类"></a>Matches-any Pseudo-class——:matches 伪类</h1><blockquote>
<p><code>:matches()</code> 用于匹配所述规则的元素，并应用相应的样式规则，同样不允许嵌套使用，<code>-webkit-any()</code> 和 <code>-moz-any()</code> 是它的两个兼容性写法。</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.matches</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.matches</span> <span class="selector-pseudo">:matches(span</span>, <span class="selector-tag">div</span>) <span class="selector-pseudo">:matches(span</span>, <span class="selector-tag">div</span>) &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span><br><span class="line">等同于</span><br><span class="line">.matches span div,</span><br><span class="line">.matches span span,</span><br><span class="line">.matches div span,</span><br><span class="line">.matches div div &#123;</span><br><span class="line">  color: green;</span><br><span class="line">&#125;</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.matches</span> <span class="selector-pseudo">:-webkit-any(span</span>, <span class="selector-tag">div</span>) <span class="selector-pseudo">:-webkit-any(span</span>, <span class="selector-tag">div</span>) &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.matches</span> <span class="selector-pseudo">:-moz-any(span</span>, <span class="selector-tag">div</span>) <span class="selector-pseudo">:-moz-any(span</span>, <span class="selector-tag">div</span>) &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.matches</span> <span class="selector-pseudo">:matches(.a</span>, <span class="selector-class">.b</span>) <span class="selector-pseudo">:matches(.a</span>, <span class="selector-class">.b</span>) &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span><br><span class="line">等同于</span><br><span class="line">.matches .a .a,</span><br><span class="line">.matches .a .b,</span><br><span class="line">.matches .b .a,</span><br><span class="line">.matches .b .b &#123;</span><br><span class="line">  color: red;</span><br><span class="line">&#125;</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.matches</span> <span class="selector-pseudo">:-webkit-any(.a</span>, <span class="selector-class">.b</span>) <span class="selector-pseudo">:-webkit-any(.a</span>, <span class="selector-class">.b</span>) &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.matches</span> <span class="selector-pseudo">:-moz-any(.a</span>, <span class="selector-class">.b</span>) <span class="selector-pseudo">:-moz-any(.a</span>, <span class="selector-class">.b</span>) &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"matches"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>绿色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>绿色<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>绿色<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>绿色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"a"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"b"</span>&gt;</span>红色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"b"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"a"</span>&gt;</span>红色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"a"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"a"</span>&gt;</span>红色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"b"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"b"</span>&gt;</span>红色<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>想解锁更多姿势就去看 <a href="https://www.w3.org/TR/2013/WD-selectors4-20130502/#matches" target="_blank" rel="external">The Matches-any Pseudo-class 草案</a></p>
</blockquote>
<h1 id="Case-Sensitivity——不区分大小写匹配标识"><a href="#Case-Sensitivity——不区分大小写匹配标识" class="headerlink" title="Case-Sensitivity——不区分大小写匹配标识"></a>Case-Sensitivity——不区分大小写匹配标识</h1><blockquote>
<p><code>Case-Sensitivity</code> 用于声明某个匹配规则中，对字符串或者某个 value 的匹配不区分大小写。该标志声明于 <code>]</code> 即右中括号之前，例如 <code>[data-value=&quot;case&quot; i]</code>，其中的 <code>i</code> 就是 Case-Sensitivity 标识。</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.case-sensitivity</span> <span class="selector-pseudo">:matches(</span><span class="selector-attr">[data-value="case" i]</span>) &#123;</span><br><span class="line">  <span class="attribute">color</span>: yellow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"case-sensitivity"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">data-value</span>=<span class="string">'Case'</span>&gt;</span>Case<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">data-value</span>=<span class="string">"case"</span>&gt;</span>case<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>以上的例子，<code>data-value</code> 虽然既有大写也有小写，但是由于我们声明了 <code>Case-Sensitivity</code>，所以无论大小写都会被匹配。像例子中 <code>case</code>，<code>Case</code>，<code>CASE</code> 等都会被匹配。</p>
<blockquote>
<p>想解锁更多姿势就去看 <a href="https://www.w3.org/TR/2013/WD-selectors4-20130502/#attribute-case" target="_blank" rel="external">Case-sensitivity 草案</a></p>
</blockquote>
<h1 id="The-Directionality-Pseudo-class——-dir"><a href="#The-Directionality-Pseudo-class——-dir" class="headerlink" title="The Directionality Pseudo-class——:dir()"></a>The Directionality Pseudo-class——:dir()</h1><blockquote>
<p><code>:dir()</code> 伪类用于匹配符合某个方向性的元素，例如 <code>:dir(ltr)</code> 和 <code>dir(rtl)</code>。顾名思义，<code>ltr</code> 表示 <code>left to right</code>，即方向从左到右，<code>rtl</code> 表示 <code>right-to-left</code>，即方向从右到左。值得注意的是，使用 <code>:dir()</code> 匹配元素和使用 <code>[dir=...]</code> 在某个程度上是一样的效果，但是一个区别是 <code>[dir=...]</code> 无法匹配到没有显示声明 <code>dir</code> 的元素，但是 <code>:dir()</code> 却可以匹配到由浏览器计算得到或者继承来的 <code>dir</code> 属性的元素，详情可以看一下<a href="https://www.w3.org/TR/2013/WD-selectors4-20130502/#dir-pseudo" target="_blank" rel="external">草案</a>。</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.dir</span> <span class="selector-pseudo">:dir(ltr)</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.dir</span> <span class="selector-pseudo">:dir(rtl)</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"dir"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">dir</span>=<span class="string">"ltr"</span>&gt;</span>从左到右<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">dir</span>=<span class="string">"rtl"</span>&gt;</span>从右到左<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>想解锁更多姿势就去看 <a href="https://www.w3.org/TR/2013/WD-selectors4-20130502/#dir-pseudo" target="_blank" rel="external">The Directionality Pseudo-class 草案</a></p>
</blockquote>
<h1 id="The-Language-Pseudo-class——-lang"><a href="#The-Language-Pseudo-class——-lang" class="headerlink" title="The Language Pseudo-class——:lang()"></a>The Language Pseudo-class——:lang()</h1><blockquote>
<p><code>:lang()</code> 用于匹配声明了 <code>lang=value</code> 的元素，并且可以使用通配符匹配，例如 <code>p:lang(*-CH)</code> 将可以匹配 <code>de-CH</code> 的 <code>p</code> 元素。</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.lang</span> <span class="selector-tag">p</span><span class="selector-pseudo">:lang(de-DE)</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.lang</span> <span class="selector-tag">p</span><span class="selector-pseudo">:lang(</span>*<span class="selector-tag">-CH</span>) &#123;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"lang"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">lang</span>=<span class="string">"de-DE-1996"</span>&gt;</span>de-DE-1996<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">lang</span>=<span class="string">"de-CH"</span>&gt;</span>de-CH<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>想解锁更多姿势就去看 <a href="https://www.w3.org/TR/2013/WD-selectors4-20130502/#lang-pseudo" target="_blank" rel="external">The language pseudo-class 草案</a></p>
</blockquote>
<h1 id="The-Hyperlink-Pseudo-class——-any-link-伪类"><a href="#The-Hyperlink-Pseudo-class——-any-link-伪类" class="headerlink" title="The Hyperlink Pseudo-class——:any-link 伪类"></a>The Hyperlink Pseudo-class——:any-link 伪类</h1><blockquote>
<p><code>:any-link</code> 用于匹配带有 <code>href</code> 属性的超链接元素，例如 <code>&lt;a&gt;</code>，<code>&lt;area&gt;</code>，<code>&lt;link&gt;</code> 等带有 <code>href</code> 属性的元素。<code>:-webkit-any-link</code> 和 <code>:-moz-any-link</code> 是它的兼容性写法。</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.link</span> <span class="selector-tag">a</span><span class="selector-pseudo">:any-link</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.link</span> <span class="selector-tag">a</span><span class="selector-pseudo">:-webkit-any-link</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.link</span> <span class="selector-tag">a</span><span class="selector-pseudo">:-moz-any-link</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"link"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>我是带有颜色的超链接<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>想解锁更多姿势就去看 <a href="https://www.w3.org/TR/2013/WD-selectors4-20130502/#the-any-link-pseudo" target="_blank" rel="external">The Hyperlink Pseudo-class 草案</a></p>
</blockquote>
<h1 id="The-contextual-reference-element-pseudo-class——-scope"><a href="#The-contextual-reference-element-pseudo-class——-scope" class="headerlink" title="The contextual reference element pseudo-class——:scope"></a>The contextual reference element pseudo-class——:scope</h1><blockquote>
<p><code>:scope</code> 用于匹配当前作用域下的顶级元素。但是目前已经被移出规范——<a href="https://github.com/whatwg/html/issues/552#issuecomment-249038746" target="_blank" rel="external">issue</a></p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"scope"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>This paragraph is outside the scope.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="css"></span><br><span class="line">      <span class="selector-pseudo">:scope</span> &#123;</span><br><span class="line">        <span class="attribute">background-color</span>: red;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="selector-tag">p</span> &#123;</span><br><span class="line">        <span class="attribute">color</span>: blue;</span><br><span class="line">      &#125;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>This paragraph is inside the scope.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>以上代码，第二个 <code>div</code> 将会有红色背景，并且他的所有 <code>&lt;p&gt;</code> 子元素都将拥有蓝色文字。</p>
<blockquote>
<p>想解锁更多姿势就去看 <a href="https://www.w3.org/TR/2013/WD-selectors4-20130502/#the-scope-pseudo" target="_blank" rel="external">The contextual reference element pseudo-class 草案</a></p>
</blockquote>
<h1 id="Time-dimensional-Pseudo-classes——-current-past-future"><a href="#Time-dimensional-Pseudo-classes——-current-past-future" class="headerlink" title="Time-dimensional Pseudo-classes——:current(), :past(), :future()"></a>Time-dimensional Pseudo-classes——:current(), :past(), :future()</h1><blockquote>
<p>我个人用 <code>时间轴伪类</code> 统一称呼 <code>:current()</code>, <code>:past()</code>, <code>:future()</code> 这三个伪类。<code>:current()</code> 匹配时间轴当前的元素，<code>:past()</code> 匹配 <code>:current()</code>元素之前的元素，<code>:future()</code> 则匹配当前时间轴后的所有元素。这里说的时间轴指的是例如 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Video_Text_Tracks_Format" target="_blank" rel="external"><code>WebVTT</code></a>。值得注意的是，规范中写道如果使用的时间轴并不是文档语言所规定的，那么 <code>:past()</code> 和 <code>:future()</code> 有可能分别匹配 <code>:current()</code> 元素的前面的兄弟元素和后面的兄弟元素。由于在 Chrome Canary 和 Safari TP 上都不支持这几个伪类，所以无法实验正确性。下面使用的例子是从<a href="http://css4-selectors.com/selector/css4/time-dimensional-pseudo-class/" target="_blank" rel="external">这个网址</a>摘过来的。</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:current(p</span>, <span class="selector-tag">span</span>) &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: yellow;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">:past(p</span>, <span class="selector-tag">span</span>),</span><br><span class="line"><span class="selector-pseudo">:future(p</span>, <span class="selector-tag">span</span>) &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: gray;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">controls</span> <span class="attr">preload</span>=<span class="string">"metadata"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">"http://html5demos.com/assets/dizzy.mp4"</span> <span class="attr">type</span>=<span class="string">"video/mp4"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">"http://html5demos.com/assets/dizzy.webm"</span> <span class="attr">type</span>=<span class="string">"video/webm"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">"http://html5demos.com/assets/dizzy.ogv"</span> <span class="attr">type</span>=<span class="string">"video/ogv"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">track</span> <span class="attr">label</span>=<span class="string">"English"</span> <span class="attr">kind</span>=<span class="string">"subtitles"</span> <span class="attr">srclang</span>=<span class="string">"en"</span> <span class="attr">src</span>=<span class="string">"http://www.iandevlin.com/html5test/webvtt/upc-video-subtitles-en.vtt"</span> <span class="attr">default</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>想解锁更多姿势就去看 <a href="https://www.w3.org/TR/2013/WD-selectors4-20130502/#time-pseudos" target="_blank" rel="external">Time-dimensional Pseudo-classes 草案</a></p>
</blockquote>
<h1 id="The-Indeterminate-value-Pseudo-class——-indeterminate"><a href="#The-Indeterminate-value-Pseudo-class——-indeterminate" class="headerlink" title="The Indeterminate-value Pseudo-class——:indeterminate"></a>The Indeterminate-value Pseudo-class——:indeterminate</h1><blockquote>
<p>在 <code>radio</code> 和 <code>checkbox</code> 元素上一般有两种状态——<code>选中</code> 和 <code>未选中</code>，但是有的时候的状态会是不确定状态，而 <code>:indeterminate</code> 就是匹配这种不确定状态的 <code>radio</code> 或 <code>checkbox</code>。</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:indeterminate</span> + <span class="selector-tag">label</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: gray;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">id</span>=<span class="string">"test"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"test"</span>&gt;</span>未确定状态<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面例子的 <code>&lt;label&gt;</code> 在 <code>&lt;input&gt;</code> 处于 <code>indeterminate state</code> 的时候，文字将会变为灰色。</p>
<blockquote>
<p>想解锁更多姿势就去看 <a href="https://www.w3.org/TR/2013/WD-selectors4-20130502/#indeterminate" target="_blank" rel="external">The Indeterminate-value Pseudo-class 草案</a></p>
</blockquote>
<h1 id="The-default-option-pseudo-class——-default"><a href="#The-default-option-pseudo-class——-default" class="headerlink" title="The default-option pseudo-class——:default"></a>The default-option pseudo-class——:default</h1><blockquote>
<p><code>:default</code> 匹配一组相似元素集合中的默认元素，例如 <code>&lt;form&gt;</code> 中有多个 <code>&lt;input&gt;</code>，其中有一个是 <code>&lt;input type=&quot;submit&quot;&gt;</code>，那么该元素将会被匹配。此外还有 <code>&lt;option&gt;</code> 也有默认元素。</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.default</span> <span class="selector-class">.default-form</span> <span class="selector-pseudo">:default</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: gray;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"default"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"default-form"</span> <span class="attr">action</span>=<span class="string">"#"</span> <span class="attr">method</span>=<span class="string">"get"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"reset"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"reset"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>想解锁更多姿势就去看 <a href="https://www.w3.org/TR/2013/WD-selectors4-20130502/#the-default-pseudo" target="_blank" rel="external">The default-option pseudo-class 草案</a></p>
</blockquote>
<h1 id="The-validity-pseudo-classes——-valid-invalid"><a href="#The-validity-pseudo-classes——-valid-invalid" class="headerlink" title="The validity pseudo-classes——:valid, :invalid"></a>The validity pseudo-classes——:valid, :invalid</h1><blockquote>
<p>在 <code>&lt;input type=&quot;email&quot;&gt;</code> 中，如果我们输入了 <code>abc123</code>，那么此时 <code>:invalid</code> 将会匹配该元素，假如我们输入 <code>abc123@163.com</code>，那么此时 <code>:valid</code> 将会匹配该元素。这里要注意假如我们没有为 <code>&lt;input&gt;</code> 作约束，例如 <code>&lt;input type=&quot;text&quot;&gt;</code>，那么它的任意输入将使元素既不会被 <code>:valid</code> 匹配，也不会被 <code>:invalid</code> 匹配。</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.valid</span> <span class="selector-tag">input</span><span class="selector-pseudo">:valid</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.valid</span> <span class="selector-tag">input</span><span class="selector-pseudo">:invalid</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"valid"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">name</span>=<span class="string">"eamil_valid"</span> <span class="attr">value</span>=<span class="string">"abc@abc.com"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">name</span>=<span class="string">"email_invalid"</span> <span class="attr">value</span>=<span class="string">"abc"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>想解锁更多姿势就去看 <a href="https://www.w3.org/TR/2013/WD-selectors4-20130502/#validity-pseudos" target="_blank" rel="external">The validity pseudo-classes 草案</a></p>
</blockquote>
<h1 id="The-range-pseudo-classes——-in-range-out-of-range"><a href="#The-range-pseudo-classes——-in-range-out-of-range" class="headerlink" title="The range pseudo-classes——:in-range, :out-of-range"></a>The range pseudo-classes——:in-range, :out-of-range</h1><blockquote>
<p><code>:in-range</code> 和 <code>:out-of-range</code> 只对有被条件约束的元素起作用，例如 <code>&lt;input type=&quot;number&quot; min=&quot;1&quot; value=&quot;1&quot;&gt;</code>，如果输入数字小于 1，那么将会被 <code>:out-of-range</code> 匹配，反之则是被 <code>:in-range</code> 匹配。</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.range</span> <span class="selector-tag">input</span><span class="selector-pseudo">:in-range</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.range</span> <span class="selector-tag">input</span><span class="selector-pseudo">:out-of-range</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"range"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"number"</span> <span class="attr">name</span>=<span class="string">"range"</span> <span class="attr">value</span>=<span class="string">"1"</span> <span class="attr">min</span>=<span class="string">"1"</span> <span class="attr">max</span>=<span class="string">"10"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>想解锁更多姿势就去看 <a href="https://www.w3.org/TR/2013/WD-selectors4-20130502/#range-pseudos" target="_blank" rel="external">The range pseudo-classes 草案</a></p>
</blockquote>
<h1 id="The-optionality-pseudo-classes——-required-optional"><a href="#The-optionality-pseudo-classes——-required-optional" class="headerlink" title="The optionality pseudo-classes——:required, :optional"></a>The optionality pseudo-classes——:required, :optional</h1><blockquote>
<p><code>:required</code> 和 <code>:optional</code> 分别匹配带有 <code>required</code> 标识的元素和不带 <code>required</code> 标识的元素。</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.optionality</span> <span class="selector-tag">input</span><span class="selector-pseudo">:required</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.optionality</span> <span class="selector-tag">input</span><span class="selector-pseudo">:optional</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"optionality"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"required"</span> <span class="attr">value</span>=<span class="string">"required"</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"optional"</span> <span class="attr">value</span>=<span class="string">"optional"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>想解锁更多姿势就去看 <a href="https://www.w3.org/TR/2013/WD-selectors4-20130502/#opt-pseudos" target="_blank" rel="external">The optionality pseudo-classes 草案</a></p>
</blockquote>
<h1 id="The-user-interaction-pseudo-class——-user-error"><a href="#The-user-interaction-pseudo-class——-user-error" class="headerlink" title="The user-interaction pseudo-class——:user-error"></a>The user-interaction pseudo-class——:user-error</h1><blockquote>
<p><code>:user-error</code> 会匹配 <code>:invalid</code>, <code>:out-of-range</code> 和没有任何值的 <code>:required</code> 元素，但是假如是初始化时就触发这三种错误，<code>user-error</code> 将不会匹配该元素，只有当用户和元素进行交互或者提交了该表单并且触发了这三种错误，<code>:user-error</code> 才会被触发。Chrome 和 Safari 可能尚未支持（也可能是我使用姿势不对，希望指正），所以无法验证正确性。</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.user-error</span> <span class="selector-tag">input</span><span class="selector-pseudo">:user-error</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.user-error</span> <span class="selector-tag">input</span><span class="selector-pseudo">:valid</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"user-error"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">name</span>=<span class="string">"eamil_valid"</span> <span class="attr">value</span>=<span class="string">"abc@abc.com"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">name</span>=<span class="string">"email_invalid"</span> <span class="attr">value</span>=<span class="string">"abc"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>想解锁更多姿势就去看 <a href="https://www.w3.org/TR/2013/WD-selectors4-20130502/#user-pseudos" target="_blank" rel="external">The user-interaction pseudo-class 草案</a></p>
</blockquote>
<h1 id="The-mutability-pseudo-classes——-read-only-read-write"><a href="#The-mutability-pseudo-classes——-read-only-read-write" class="headerlink" title="The mutability pseudo-classes——:read-only, :read-write"></a>The mutability pseudo-classes——:read-only, :read-write</h1><blockquote>
<p><code>:read-only</code> 匹配不可被编辑的元素，<code>:read-write</code> 则匹配可被编辑的元素，例如 <code>&lt;input&gt;</code> 或者 <code>contenteditable=&quot;true&quot;</code> 的元素。<code>:-moz-read-only</code> 和 <code>:-moz-read-write</code> 分别是他们的兼容性写法。</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.mutability</span> <span class="selector-pseudo">:read-only</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.mutability</span> <span class="selector-pseudo">:read-write</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"mutability"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"read-write-input"</span> <span class="attr">value</span>=<span class="string">"read-write"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">contenteditable</span>=<span class="string">"true"</span>&gt;</span>read-write-paragraph<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>read-only-paragraph<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>想解锁更多姿势就去看 <a href="https://www.w3.org/TR/2013/WD-selectors4-20130502/#rw-pseudos" target="_blank" rel="external">The mutability pseudo-classes 草案</a></p>
</blockquote>
<h1 id="The-placeholder-shown-pseudo-class——-placeholder-shown"><a href="#The-placeholder-shown-pseudo-class——-placeholder-shown" class="headerlink" title="The placeholder-shown pseudo-class——:placeholder-shown"></a>The placeholder-shown pseudo-class——:placeholder-shown</h1><blockquote>
<p><code>:placeholder-shown</code> 匹配 <code>placeholder</code> 文字显示时的 <code>&lt;input&gt;</code> 元素。<code>::-webkit-input-placeholder</code>, <code>::-moz-placeholder</code>, <code>:-ms-input-placeholder</code> 分别是它在不同浏览器的兼容性写法。</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.placeholder</span> <span class="selector-tag">input</span><span class="selector-pseudo">:placeholder-shown</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.placeholder</span> <span class="selector-tag">input</span><span class="selector-pseudo">::-webkit-input-placeholder</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.placeholder</span> <span class="selector-tag">input</span><span class="selector-pseudo">::-moz-placeholder</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.placeholder</span> <span class="selector-tag">input</span><span class="selector-pseudo">:-ms-input-placeholder</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"placeholder"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"placeholder"</span> <span class="attr">placeholder</span>=<span class="string">"placeholder is green"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>想解锁更多姿势就去看 <a href="https://www.w3.org/TR/2013/WD-selectors4-20130502/#placeholder" target="_blank" rel="external">The placeholder-shown pseudo-class 草案</a></p>
</blockquote>
<h1 id="Grid-Structural-Selectors"><a href="#Grid-Structural-Selectors" class="headerlink" title="Grid-Structural Selectors"></a>Grid-Structural Selectors</h1><blockquote>
<p>该特性将对例如 <code>&lt;table&gt;</code> 的栅格布局起作用。它包含 <code>:column(selector)</code>, <code>:nth-column(n)</code> 和 <code>:nth-last-column(n)</code>。目前浏览器都还未支持，无法实验正确性。</p>
</blockquote>
<h2 id="column-selector"><a href="#column-selector" class="headerlink" title=":column(selector)"></a>:column(selector)</h2><blockquote>
<p><code>:column(selector)</code> 将匹配例如 <code>&lt;table&gt;</code> 中 带有 <code>selector</code> 类名的那一列的所有元素。</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:column(.selected)</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">col</span> <span class="attr">class</span>=<span class="string">"selected"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">col</span> <span class="attr">class</span>=<span class="string">"blur"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">col</span> <span class="attr">class</span>=<span class="string">"blur"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>A<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>B<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>C<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>D<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>E<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>F<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>G<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>H<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>I<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在上面的例子中，A、D、G 都将是绿色的。</p>
<h2 id="nth-column-n-和-nth-last-column-n"><a href="#nth-column-n-和-nth-last-column-n" class="headerlink" title=":nth-column(n) 和 :nth-last-column(n)"></a>:nth-column(n) 和 :nth-last-column(n)</h2><blockquote>
<p><code>:nth-column(n)</code> 匹配括号内 <code>n</code> 的计算值的某一列的元素，计算方式是从头开始计算，而 <code>:nth-last-column(n)</code> 则是从后开始计算。</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:nth-column(2n)</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">:nth-last-column(3n)</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">col</span> <span class="attr">class</span>=<span class="string">"selected"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">col</span> <span class="attr">class</span>=<span class="string">"blur"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">col</span> <span class="attr">class</span>=<span class="string">"blur"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>A<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>B<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>C<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>D<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>E<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>F<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>G<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>H<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>I<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>想解锁更多姿势就去看 <a href="https://www.w3.org/TR/2013/WD-selectors4-20130502/#table-pseudos" target="_blank" rel="external">Grid-Structural Selectors 草案</a></p>
</blockquote>
<h1 id="Tree-Structural-pseudo-classes——-blank"><a href="#Tree-Structural-pseudo-classes——-blank" class="headerlink" title="Tree-Structural pseudo-classes——:blank"></a>Tree-Structural pseudo-classes——:blank</h1><blockquote>
<p>Tree-Structural pseudo-classes 是 CSS3 中的规范，但在 CSS Selectors Level 4 中加入了 <code>:blank</code>，它和 <code>:empty</code> 类似，区别在于 <code>:empty</code> 只能匹配没有任何内容的元素，而 <code>:blank</code> 可以匹配带有 <code>spaces（空格）</code>, <code>tabs（缩进符）</code> and <code>segment breaks（段落过段）</code> 内容的元素。</p>
<p>想解锁更多姿势就去看 <a href="https://www.w3.org/TR/2013/WD-selectors4-20130502/#blank-pseudo" target="_blank" rel="external">:blank pseudo-class 草案</a></p>
</blockquote>
<h1 id="Combinators——-gt-gt"><a href="#Combinators——-gt-gt" class="headerlink" title="Combinators——&gt;&gt;"></a>Combinators——<code>&gt;&gt;</code></h1><blockquote>
<p><code>A &gt;&gt; B</code> 匹配祖先元素为 A 的 B元素，其用法与 <code>A B</code> 一样，与 <code>&gt;</code>, <code>+</code>, <code>~</code> 用意一样，不过意义不同。</p>
<p>想解锁更多姿势就去看 <a href="https://www.w3.org/TR/2013/WD-selectors4-20130502/#combinators" target="_blank" rel="external">Combinators 草案</a></p>
</blockquote>
<hr>
<blockquote>
<p>上面的特性都已经存在 Working Draft 中，还有一些 Editor’s Draft 的特性，也顺带一提。</p>
</blockquote>
<h1 id="The-Relational-Pseudo-class——-has"><a href="#The-Relational-Pseudo-class——-has" class="headerlink" title="The Relational Pseudo-class——:has()"></a>The Relational Pseudo-class——:has()</h1><blockquote>
<p><code>:has(selector)</code> 匹配含有 <code>某些规则</code> 的元素。</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 将匹配含有 img 子元素的 a 元素 */</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:has(</span>&gt; <span class="selector-tag">img</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 将匹配拥有 dt 兄弟元素的 dt 元素 */</span></span><br><span class="line"><span class="selector-tag">dt</span><span class="selector-pseudo">:has(+</span> <span class="selector-tag">dt</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 将匹配不含有 h1、h2、h3、h4、h5、h6 元素的 section 元素 */</span></span><br><span class="line"><span class="selector-tag">section</span><span class="selector-pseudo">:not(</span><span class="selector-pseudo">:has(h1</span>, <span class="selector-tag">h2</span>, <span class="selector-tag">h3</span>, <span class="selector-tag">h4</span>, <span class="selector-tag">h5</span>, <span class="selector-tag">h6</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 和上面例子不同，下面交换了两个伪类的嵌套，表示匹配含有的不是 h1、h2、h3、h4、h5、h6 子元素的元素，区别在于这种写法要求必须含有一个子元素，而上面的写法可以不含有子元素也会被匹配 */</span></span><br><span class="line"><span class="selector-tag">section</span><span class="selector-pseudo">:has(</span><span class="selector-pseudo">:not(h1</span>, <span class="selector-tag">h2</span>, <span class="selector-tag">h3</span>, <span class="selector-tag">h4</span>, <span class="selector-tag">h5</span>, <span class="selector-tag">h6</span>))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>想解锁更多姿势就去看 <a href="https://drafts.csswg.org/selectors-4/#has-pseudo" target="_blank" rel="external">The Relational Pseudo-class 草案</a></p>
</blockquote>
<h1 id="The-Drag-and-Drop-Pseudo-class——-drop-drop"><a href="#The-Drag-and-Drop-Pseudo-class——-drop-drop" class="headerlink" title="The Drag-and-Drop Pseudo-class——:drop, :drop()"></a>The Drag-and-Drop Pseudo-class——:drop, :drop()</h1><blockquote>
<p><code>:drop</code> 和 <code>:drop()</code> 匹配可被放置拖动元素的目标元素，两者区别在于 <code>:drop()</code> 可以匹配一些规则，包括 <code>active</code>, <code>valid</code>, <code>invalid</code>。<code>active</code> 会匹配可被放置的目标元素，<code>valid</code> 匹配放置的元素为合法元素的目标元素，<code>invalid</code> 反之。如果 <code>:drop()</code> 括号里没有任何过滤，那么将和 <code>:drop</code> 没有区别。</p>
<p>想解锁更多姿势就去看 <a href="https://drafts.csswg.org/selectors-4/#selectordef-drop-function" target="_blank" rel="external">The Drag-and-Drop Pseudo-class 草案</a></p>
</blockquote>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>这篇博客算是一篇科普文，趁着空余时间将 CSS Selectors Level 4 的一些新的特性总结了一下，可能有所错漏或理解错误，我也十分各位帮我指出错误之处或不足之处！另外，国庆节快乐，祝你们玩得开心，单身狗继续写代码了~</p>
<p>参考资料：</p>
<blockquote>
<p><a href="https://www.w3.org/TR/2013/WD-selectors4-20130502/" target="_blank" rel="external">https://www.w3.org/TR/2013/WD-selectors4-20130502/</a><br><a href="https://drafts.csswg.org/selectors-4/" target="_blank" rel="external">https://drafts.csswg.org/selectors-4/</a><br><a href="http://css4.rocks/selectors-level-4/" target="_blank" rel="external">http://css4.rocks/selectors-level-4/</a><br><a href="http://css4-selectors.com/selectors/" target="_blank" rel="external">http://css4-selectors.com/selectors/</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/10/SameSite-Cookie——防御-CSRF-XSSI/" itemprop="url">
                  SameSite-Cookie——防御 CSRF & XSSI
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-10T23:06:38+08:00" content="2016-07-10">
              2016-07-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/前端/前端安全/" itemprop="url" rel="index">
                    <span itemprop="name">前端安全</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/10/SameSite-Cookie——防御-CSRF-XSSI/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/10/SameSite-Cookie——防御-CSRF-XSSI/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="SameSite——防御-CSRF-amp-XSSI-新机制"><a href="#SameSite——防御-CSRF-amp-XSSI-新机制" class="headerlink" title="SameSite——防御 CSRF &amp; XSSI 新机制"></a>SameSite——防御 CSRF &amp; XSSI 新机制</h1><blockquote>
<p><code>SameSite-cookies</code> 是 Google 开发的用于防御 CSRF 和 XSSI（Cross Site Script Inclusion，跨域脚本包含）的新安全机制，只需在 <code>Set-Cookie</code> 中加入一个新的字段属性，浏览器会根据设置的安全级别进行对应的安全 cookie 发送拦截，而目前在 Chrome-dev（51.0.2704.4）中可用。</p>
</blockquote>
<h2 id="XSSI——Cross-Site-Script-Inclusion"><a href="#XSSI——Cross-Site-Script-Inclusion" class="headerlink" title="XSSI——Cross Site Script Inclusion"></a>XSSI——Cross Site Script Inclusion</h2><p><code>XSSI</code> 属于 <code>XSS</code> 攻击的一种攻击方式，一般来说，浏览器允许网页加载其他域的脚本或图片等，假设我们在安全的网站上 a.com 包含一个脚本文件 <code>getData.js</code> 用于读取用户的私人信息，第一次用户需要在 a.com 登录，然后就可以根据验证返回用户私人信息并设置 cookie 以便下次使用，此时我们只做一个恶意网站 c.com，并包含了 <code>getData.js</code> 这个脚本文件，当用户点击 c.com 时，他的信息就泄露了。</p>
<p>当然，这种方法可以用 <code>token</code> 令牌等来解决，另外一种方法就是 <code>SameSite-Cookies</code>，通过验证是否是从 a.com 访问的 getData.js 的方式来阻止 cookie 的发送。</p>
<h2 id="SameSite-使用方式"><a href="#SameSite-使用方式" class="headerlink" title="SameSite 使用方式"></a>SameSite 使用方式</h2><p>需要在 <code>Set-Cookie</code> 中加入 <code>SameSite</code> 关键字，例如</p>
<blockquote>
<p>Set-Cookie: key=value; HttpOnly; SameSite=Strict</p>
</blockquote>
<h2 id="SameSite-的两个属性"><a href="#SameSite-的两个属性" class="headerlink" title="SameSite 的两个属性"></a>SameSite 的两个属性</h2><h3 id="no-restriction"><a href="#no-restriction" class="headerlink" title="no_restriction"></a>no_restriction</h3><p>当没有添加 SameSite 关键字的时候，默认是空的</p>
<h3 id="Lax"><a href="#Lax" class="headerlink" title="Lax"></a>Lax</h3><ul>
<li>允许发送安全 HTTP 方法（<code>GET</code>, <code>HEAD</code>, <code>OPTIONS</code>, <code>TRACE</code>）第三方链接的 cookies</li>
<li>必须是 TOP-LEVEL 即可引起地址栏变化的跳转方式，例如 <code>&lt;a&gt;</code>, <code>&lt;link rel=&quot;prerender&quot;&gt;</code>, <code>GET 方式的 form 表单</code>，此外，<code>XMLHttpRequest</code>, <code>&lt;img&gt;</code> 等方式进行 GET 方式的访问将不会发送 cookies</li>
<li>但是禁止发送不安全 HTTP 方法（<code>POST</code>, <code>PUT</code>, <code>DELETE</code>）第三方链接的cookies</li>
</ul>
<h3 id="Strict"><a href="#Strict" class="headerlink" title="Strict"></a>Strict</h3><p>禁止发送所有第三方链接的 cookies，默认情况下，如果添加了 SameSite 关键字，但是没有指定 value（Lax or Stict），那么默认为 Strict</p>
<h2 id="Strict-下的-Request-Cookie-变化"><a href="#Strict-下的-Request-Cookie-变化" class="headerlink" title="Strict 下的 Request Cookie 变化"></a>Strict 下的 Request Cookie 变化</h2><p>当我们通过其他网站来访问一个有 SameSite-Cookies 机制的网站时，例如从 a.com 点击链接进入 b.com，如果 b.com 设置了 <code>Set-Cookie:foo=bar;SameSite=Strict</code>，那么，<code>foo=bar</code> 这一 cookie 是不会随着 request 发送的，如下图：</p>
<p><img src="http://7xoehm.com1.z0.glb.clouddn.com/outerLink.png" alt="outerLink"></p>
<p>可以看到 <code>foo=bar</code> 并没有发送，假如此时刷新一下页面或者直接从地址栏输入 b.com 的地址，那么 cookie 将会正常发送，不过假设用户点击了外链进入了 b.com，由于 SameSite-Cookies 的保护，他的 cookie 第一次受到了保护，但是假设用户此时手动刷新了一下页面，那么 cookie 将会被发送出去，所以可能需要其他一些验证手段来对 cookie 未随 request 发送的情况来做相对应的处理，不过该种情况仅限于 GET 方法下，如下图：</p>
<p><img src="http://7xoehm.com1.z0.glb.clouddn.com/innerLink.png" alt="innerLink"></p>
<p>此外，为了更清楚地了解 cookie 中哪些字段是 SameSite 控制并且级别为 Lax 或 Strict 或 none，我们可以在 Chrome DevTools 上清楚地看到，如下图：</p>
<p><img src="http://7xoehm.com1.z0.glb.clouddn.com/devTools.png" alt="devTools"></p>
<p><a href="http://www.libinhong.com:5000" target="_blank" rel="external">点击查看 DEMO</a></p>
<p>参考资料：</p>
<ul>
<li><a href="http://www.sjoerdlangkemper.nl/2016/04/14/preventing-csrf-with-samesite-cookie-attribute/" target="_blank" rel="external">http://www.sjoerdlangkemper.nl/2016/04/14/preventing-csrf-with-samesite-cookie-attribute/</a></li>
<li><a href="https://tools.ietf.org/html/draft-west-first-party-cookies-07" target="_blank" rel="external">https://tools.ietf.org/html/draft-west-first-party-cookies-07</a></li>
<li><a href="https://chloe.re/2016/04/13/goodbye-csrf-samesite-to-the-rescue/" target="_blank" rel="external">https://chloe.re/2016/04/13/goodbye-csrf-samesite-to-the-rescue/</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/17/reflow-和-repaint-简易分析/" itemprop="url">
                  reflow 和 repaint 简易分析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-17T10:16:50+08:00" content="2016-06-17">
              2016-06-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/前端/CSS/" itemprop="url" rel="index">
                    <span itemprop="name">CSS</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/17/reflow-和-repaint-简易分析/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/17/reflow-和-repaint-简易分析/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://7xoehm.com1.z0.glb.clouddn.com/1448333443367.jpg" alt="福利"></p>
<h1 id="浏览器渲染"><a href="#浏览器渲染" class="headerlink" title="浏览器渲染"></a>浏览器渲染</h1><p>当我们打开一个网页的时候，浏览器是如何将 HTML 代码转换为用户可见的视图的？浏览器又在何时进行 <code>repaint</code> 和 <code>reflow</code> 的操作？首先我们要先知道用于该操作的 <code>渲染树</code> 的由来。</p>
<h2 id="DOM-Tree-的生成"><a href="#DOM-Tree-的生成" class="headerlink" title="DOM Tree 的生成"></a>DOM Tree 的生成</h2><blockquote>
<p>浏览器首先会解析 HTML 代码，生成一颗 <code>DOM Tree</code>，DOM（文档对象模型）</p>
</blockquote>
<p>简单地说，<code>DOM Tree</code> 的生成一般经历了四个阶段</p>
<ul>
<li>转换——浏览器将从供应方（例如本地磁盘或服务器）获取到的 HTML 字节，根据 HTML 的文件编码格式转换为字符</li>
<li>符号化——浏览对转换好的字符串进行解析，将 <code>&lt;&gt;</code> 识别为对应的符号</li>
<li>词法分析——将符号化的字符串转换为 <code>对象</code>，一般来说是节点（Node）</li>
<li>DOM 构建——对象生成完毕后，将根据对象之间的关系（父子、兄弟）生成 <code>DOM Tree</code>，在 <code>DOM Tree</code> 中可以确认 Node 节点间的关系</li>
</ul>
<h2 id="CSSOM-的生成"><a href="#CSSOM-的生成" class="headerlink" title="CSSOM 的生成"></a>CSSOM 的生成</h2><blockquote>
<p>在生成 <code>DOM Tree</code> 以后，将会生成 <code>CSSOM</code>（CSS 对象模型）的树形结构</p>
</blockquote>
<p>与构建 <code>DOM</code> 的过程类似是，<code>CSSOM</code> 的构建过程也是读取 CSS 字节，进行转换解析，并生成对应的 <code>CSSOM Tree</code>，不同的是，<code>CSSOM</code> 为 CSS 样式服务，而 <code>DOM</code> 为节点服务</p>
<h3 id="CSSOM-能干什么？"><a href="#CSSOM-能干什么？" class="headerlink" title="CSSOM 能干什么？"></a>CSSOM 能干什么？</h3><p>CSSOM 通过复杂而具体的规则计算 CSS 样式，并将其映射到对应的需要样式的节点上，其遵循 <code>向下层叠</code> 的计算规则，例如下图</p>
<p><img src="http://7xoehm.com1.z0.glb.clouddn.com/cssom-tree.png" alt="向下层叠"></p>
<p>可以看到，body 处使用了 <code>font-size: 16px</code>，根据 <code>向下层叠</code> 的规则，body 的子节点如果没有其自己的 <code>font-size</code> 规则，那么 body 的 <code>font-size</code> 规则将会层叠给该节点</p>
<h3 id="CSSOM-注意点"><a href="#CSSOM-注意点" class="headerlink" title="CSSOM 注意点"></a>CSSOM 注意点</h3><ul>
<li><code>CSSOM</code> 的构建会阻塞页面的渲染——假设页面的呈现没有等待 <code>CSSOM</code> 的构建和计算，那么用户看到的将会是一堆没有样式的页面，等到 <code>CSSOM</code> 构建以后，页面又突然间变成有样式的页面，所以等待 <code>CSSOM</code> 的构建完成再进行渲染并呈现页面是必须的，不过如果 <code>CSSOM</code> 的构建的效率很低，那么将会出现常见的 <code>白屏</code> 现象。</li>
<li>只要重新加载页面，那么 <code>CSSOM</code> 也会重新构建——不管 CSS 样式文件是否被浏览器进行了缓存，<code>CSSOM</code> 是永远不会被缓存的，它会伴随页面的每一次重新加载而加载。</li>
<li>JS 的运行所阻塞会被 <code>CSSOM</code> 的构建阻塞——在构建 <code>DOM</code> 时，遇见 <code>&lt;script&gt;</code> 标签时，浏览器会发出 HTTP 请求资源，并将控制权移交给 JavaScript 引擎，等待 JS 执行完毕归还控制权继续 <code>DOM</code> 的构建，然而，如果此时 <code>CSSOM</code> 未下载并构建完成，JS 的执行时机将被延迟</li>
</ul>
<h2 id="Render-Tree——渲染树"><a href="#Render-Tree——渲染树" class="headerlink" title="Render Tree——渲染树"></a>Render Tree——渲染树</h2><blockquote>
<p><code>渲染树</code> 由 <code>DOM Tree</code> 和 <code>CSSOM Tree</code> 融合构成，渲染树与 <code>DOM Tree</code> 和 <code>CSSOM Tree</code> 不同，渲染树只包含需要渲染的节点信息，例如 <code>display: none</code> 的节点是不存在于 <code>渲染树</code> 内的</p>
</blockquote>
<p><img src="http://7xoehm.com1.z0.glb.clouddn.com/render-tree-construction.png" alt="合成渲染树"></p>
<p>可以发现，<code>span</code> 由于拥有 <code>display: none</code> 并未包含在 <code>渲染树</code> 里。</p>
<h2 id="渲染树构建和渲染步骤"><a href="#渲染树构建和渲染步骤" class="headerlink" title="渲染树构建和渲染步骤"></a>渲染树构建和渲染步骤</h2><p>在这里我们简单说一下 <code>渲染树</code> 的构建和渲染步骤：</p>
<ul>
<li>从 <code>DOM Tree</code> 根节点开始遍历所有可见节点<ul>
<li>不可见节点（如 <code>&lt;script&gt;</code> 和 <code>&lt;meta&gt;</code> 等）将不会包含在内，会被忽略</li>
<li>通过 CSS 样式设置不可见的节点也不被包括，例如 <code>display: none</code>，不包括 <code>visibility: hidden</code> 等</li>
</ul>
</li>
<li>从 <code>CSSOM Tree</code> 找到对应节点的规则，进行匹配</li>
<li>发射可见节点，连带其内容及计算的样式</li>
<li>根据生成的渲染树计算每个节点在屏幕中的绝对像素位置</li>
<li>根据计算结果开始渲染，这一步通常称为 <code>绘制</code> 或者 <code>栅格化</code></li>
</ul>
<h1 id="重绘（repaint）和重排（reflow）"><a href="#重绘（repaint）和重排（reflow）" class="headerlink" title="重绘（repaint）和重排（reflow）"></a>重绘（repaint）和重排（reflow）</h1><p>上面我们知道了 <code>渲染树</code> 由 <code>DOM Tree</code> 和 <code>CSSOM Tree</code> 融合构建而成，但是页面并不是进行一次渲染就可以适应各种节点的几何属性改变等变化的，页面会在某些时机进行 <code>重绘（repaint）</code> 和 <code>重排（reflow）</code>。</p>
<p>我们首先要知道其二者的区别：</p>
<ul>
<li>重绘（repaint）——页面部分样式属性改变了（背景颜色，字体颜色等），但是几何属性没有改变，页面需要重绘该部分的内容，这就叫 <code>重绘（repaint）</code></li>
<li>重排（reflow）——页面节点的几何属性改变，这时候需要重新计算元素的几何属性，重新构建 <code>渲染树</code>，这就叫 <code>重排（reflow）</code></li>
</ul>
<p>同时，我们要记得一下这句话：</p>
<blockquote>
<p>重绘不一定导致重排，但是重排一定会导致重绘</p>
</blockquote>
<h2 id="repaint-和-reflow-所带来的性能问题"><a href="#repaint-和-reflow-所带来的性能问题" class="headerlink" title="repaint 和 reflow 所带来的性能问题"></a>repaint 和 reflow 所带来的性能问题</h2><p>通过前面的分析，可以预见的是，<code>repaint</code> 和 <code>reflow</code> 所需的性能消耗代价必然巨大，下面通过一个例子来说明：</p>
<p>HTML:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"elem-a"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"elem-b"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"elem-c"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"elem-d"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>JavaScript:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// example 1</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.time(<span class="string">"elem-a render time"</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> idx=<span class="number">0</span>;idx&lt;<span class="number">10000</span>;idx++) &#123;</span><br><span class="line">        <span class="built_in">document</span>.getElementById(<span class="string">"elem-a"</span>).innerHTML += idx;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.timeEnd(<span class="string">"elem-a render time"</span>);</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// example 2</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.time(<span class="string">"elem-b render time"</span>);</span><br><span class="line">    <span class="keyword">let</span> elemB = <span class="built_in">document</span>.getElementById(<span class="string">"elem-b"</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> idx=<span class="number">0</span>;idx&lt;<span class="number">10000</span>;idx++) &#123;</span><br><span class="line">        elemB.innerHTML += idx;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.timeEnd(<span class="string">"elem-b render time"</span>);</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// example 3</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.time(<span class="string">"elem-c render time"</span>);</span><br><span class="line">    <span class="keyword">let</span> str = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> idx=<span class="number">0</span>;idx&lt;<span class="number">10000</span>;idx++) &#123;</span><br><span class="line">        <span class="keyword">let</span> elemC = <span class="built_in">document</span>.getElementById(<span class="string">"elem-c"</span>);</span><br><span class="line">        str += idx;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"elem-c"</span>).innerHTML = str;</span><br><span class="line">    <span class="built_in">console</span>.timeEnd(<span class="string">"elem-c render time"</span>);</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// example 4</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.time(<span class="string">"elem-d render time"</span>);</span><br><span class="line">    <span class="keyword">let</span> elemD = <span class="built_in">document</span>.getElementById(<span class="string">"elem-d"</span>);</span><br><span class="line">    <span class="keyword">let</span> str = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> idx=<span class="number">0</span>;idx&lt;<span class="number">10000</span>;idx++) &#123;</span><br><span class="line">        str += idx;</span><br><span class="line">    &#125;</span><br><span class="line">    elemD.innerHTML += str;</span><br><span class="line">    <span class="built_in">console</span>.timeEnd(<span class="string">"elem-d render time"</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></p>
<p>上面进行了 4 次试验，每次试验的内容不一样，下面进行分析：</p>
<ul>
<li>example 1——进行 10000 次的 “DOM 索引 + 重绘 + 重排”</li>
<li>example 2——进行 10000 次的 “重绘 + 重排”，进行 1 次的 “DOM 索引”</li>
<li>example 3——进行 10000 次的 “DOM 索引”，进行 1 次的 “重绘 + 重排”</li>
<li>example 4——进行 10000 次的 “字符串拼接”，进行一次的 “DOM 索引 + 重绘 + 重排”</li>
</ul>
<p>控制台打印结果如下：</p>
<ul>
<li>elem-a render time: 6020.826ms</li>
<li>elem-b render time: 5797.140ms</li>
<li>elem-c render time: 14.061ms</li>
<li>elem-d render time: 3.905ms</li>
</ul>
<p>由结果分析可知：</p>
<ul>
<li><code>repaint</code> 和 <code>reflow</code> 消耗的性能是无比巨大的</li>
<li>DOM 索引也消耗一定的性能，但是比起 <code>repaint</code> 和 <code>reflow</code> 简直是小巫见大巫</li>
<li>优化的重点在于减少 DOM 重复索引和循环引起的 <code>repaint</code> 和 <code>reflow</code>，尽量压缩为一次</li>
</ul>
<h2 id="如何减少-repaint-和-reflow-的发生？"><a href="#如何减少-repaint-和-reflow-的发生？" class="headerlink" title="如何减少 repaint 和 reflow 的发生？"></a>如何减少 <code>repaint</code> 和 <code>reflow</code> 的发生？</h2><p>要知道如何减少 <code>repaint</code> 和 <code>reflow</code> 的发生，我们就得先知道引起它们的原因， <code>repaint</code> 无疑就是改变 DOM 的背景颜色等导致，重点在于 <code>reflow</code> 的原因：</p>
<ul>
<li>页面初始化必须进行一次的 <code>reflow</code></li>
<li>缩放窗口</li>
<li>改变字体</li>
<li>添加或删除样式</li>
<li>添加或删除元素</li>
<li>内容改变，例如用户在输入框中输入文本</li>
<li>激活了伪类样式，例如：hover</li>
<li>脚本操作 DOM 并改变了其样式</li>
<li>计算 offsetWidth 和 offsetHeight</li>
<li>设置样式属性（width，height等）</li>
</ul>
<p>以上种种都有可能引起页面的 <code>reflow</code>，而且不止这些，但是我们无法完全避免 <code>reflow</code>，所以我们必须想方设法去减少 <code>reflow</code>，例如：</p>
<ul>
<li>减少单一操作样式属性，使用 class 一次性替换</li>
<li>对有动画的元素，使其 <code>position</code> 为 <code>fixed</code> 或 <code>absolute</code>，这样会减少元素间的影响</li>
<li>使用平滑的过渡动画，例如尽量少用 1 个像素的移动动画，可以改为 3 个像素，<a href="http://www.stubbornella.org/content/2009/03/27/reflows-repaints-css-performance-making-your-javascript-slow/#smooth" target="_blank" rel="external">具体原因</a></li>
<li>避免使用 table 布局，<a href="http://www.stubbornella.org/content/2009/03/27/reflows-repaints-css-performance-making-your-javascript-slow/#tables" target="_blank" rel="external">具体原因</a></li>
<li>减少在 CSS 样式中使用 JS 表达式</li>
<li>将元素 <code>display: none</code> 后再修改样式</li>
<li>创建一个新的节点元素，进行样式操作后替代原先的元素，不过可能会出现页面闪烁</li>
<li>创建 DocumentFragment 来进行更新</li>
</ul>
<p>这里提一下浏览器自身对减少 <code>reflow</code> 的优化，下面例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> elemA = <span class="built_in">document</span>.getElementById(<span class="string">"elem-a"</span>);</span><br><span class="line"></span><br><span class="line">elemA.style.width = <span class="string">"100px"</span>;</span><br><span class="line">elemA.style.height = <span class="string">"100px"</span>;</span><br><span class="line">elemA.style.backgroundColor = <span class="string">"yellow"</span>;</span><br></pre></td></tr></table></figure></p>
<p>以上例子浏览器只会一次性进行 <code>reflow</code> 而非 3 次</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> elemA = <span class="built_in">document</span>.getElementById(<span class="string">"elem-a"</span>);</span><br><span class="line"></span><br><span class="line">elemA.style.width = <span class="string">"100px"</span>;</span><br><span class="line">elemA.style.height = <span class="string">"100px"</span>;</span><br><span class="line">elemA.getComputedStyle();</span><br><span class="line">elemA.style.backgroundColor = <span class="string">"yellow"</span>;</span><br></pre></td></tr></table></figure>
<p>以上例子浏览器会进行 2 次 <code>reflow</code>，因为中间需要获取当前的样式信息，浏览器必须先进行 <code>渲染树</code> 的重新计算，只要是获取以下样式信息的，都会引起浏览器立即重新渲染（如果必须则会 <code>reflow</code>）：</p>
<ul>
<li>offsetTop</li>
<li>offsetLeft</li>
<li>offsetWidth</li>
<li>offsetHeight</li>
<li>scrollTop</li>
<li>scrollLeft</li>
<li>scrollWidth</li>
<li>scrollHeight</li>
<li>clientTop</li>
<li>clientLeft</li>
<li>clientWidth</li>
<li>clientHeight</li>
<li>getComputedStyle()</li>
<li>currentStyle（just for IE）</li>
</ul>
<blockquote>
<p>参考</p>
</blockquote>
<ul>
<li><a href="https://varvy.com/performance/cssom.html" target="_blank" rel="external">https://varvy.com/performance/cssom.html</a></li>
<li><a href="http://www.stubbornella.org/content/2009/03/27/reflows-repaints-css-performance-making-your-javascript-slow/" target="_blank" rel="external">http://www.stubbornella.org/content/2009/03/27/reflows-repaints-css-performance-making-your-javascript-slow/</a></li>
<li><a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/constructing-the-object-model?hl=zh-cn" target="_blank" rel="external">https://developers.google.com/web/fundamentals/performance/critical-rendering-path/constructing-the-object-model?hl=zh-cn</a></li>
<li><a href="http://taligarsiel.com/Projects/howbrowserswork1.htm" target="_blank" rel="external">http://taligarsiel.com/Projects/howbrowserswork1.htm</a></li>
<li><a href="http://www.cnblogs.com/zichi/p/4720000.html" target="_blank" rel="external">http://www.cnblogs.com/zichi/p/4720000.html</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/05/angular-注意点-长期更新/" itemprop="url">
                  angular 注意点（长期更新）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-05T17:30:38+08:00" content="2016-06-05">
              2016-06-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/前端/Angular/" itemprop="url" rel="index">
                    <span itemprop="name">Angular</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/05/angular-注意点-长期更新/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/05/angular-注意点-长期更新/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>这篇 blog 主要存放我在学习和使用 angular 踩到的坑和需要注意的点</p>
</blockquote>
<h1 id="ng-repeat"><a href="#ng-repeat" class="headerlink" title="ng-repeat"></a>ng-repeat</h1><blockquote>
<p><code>ng-repeat</code> 用于标识某个 elem 需要重复输出，同时重复输出的内容需为唯一</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">"app"</span> <span class="attr">ng-controller</span>=<span class="string">"control"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">ng-repeat</span>=<span class="string">"content in repeatContent"</span>&gt;</span>ng-repeat: &#123;&#123; content &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> app = angular.module(<span class="string">"app"</span>, []);</span><br><span class="line">app.controller(<span class="string">"control"</span>, ($scope) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 输出李滨泓</span></span><br><span class="line">    $scope.repeatContent = [<span class="string">"李"</span>, <span class="string">"滨"</span>, <span class="string">"泓"</span>];</span><br><span class="line">    <span class="comment">// 下面存在两个“泓”，会报错</span></span><br><span class="line">    <span class="comment">// $scope.repeatContent = ["李", "滨", "泓", "泓"];</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="provider-service-factory-之间的关系"><a href="#provider-service-factory-之间的关系" class="headerlink" title="provider, service, factory 之间的关系"></a>provider, service, factory 之间的关系</h1><h2 id="factory"><a href="#factory" class="headerlink" title="factory"></a>factory</h2><blockquote>
<p><code>factory</code> 很像 <code>service</code>，不同之处在于，service 在 Angular 中是一个单例对象，即当需要使用 service 时，使用 new 关键字来创建一个（也仅此一个）service。而 factory 则是一个普通的函数，当需要用时，他也仅仅是一个普通函数的调用方式，它可以返回各种形式的数据，例如通过返回一个功能函数的集合对象来将供与使用。</p>
</blockquote>
<p>定义：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> app = angular.module(<span class="string">"app"</span>, []);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里可以注入 $http 等 Provider</span></span><br><span class="line">app.factory(<span class="string">"Today"</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        year: date.getFullYear(),</span><br><span class="line">        month: date.getMonth() + <span class="number">1</span>,</span><br><span class="line">        day: date.getDate()</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>使用注入：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.controller(<span class="string">"control"</span>, (Today) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(Today.year);</span><br><span class="line">    <span class="built_in">console</span>.log(Today.month);</span><br><span class="line">    <span class="built_in">console</span>.log(Today.day);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h2 id="service"><a href="#service" class="headerlink" title="service"></a>service</h2><blockquote>
<p><code>service</code> 在使用时是一个单例对象，同时也是一个 constructor，它的特点让它可以不返回任何东西，因为它使用 new 关键字新建，同时它可以用在 controller 之间的通讯与数据交互，因为 controller 在无用时其作用域链会被销毁（例如使用路由跳转到另一个页面，同时使用了另一个 controller）</p>
</blockquote>
<p>定义：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> app = angular.module(<span class="string">"app"</span>, []);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里可以注入 $http 等 Provider</span></span><br><span class="line"><span class="comment">// 注意这里不可以使用 arrow function</span></span><br><span class="line"><span class="comment">// arrow function 不能作为 constructor</span></span><br><span class="line">app.service(<span class="string">"Today"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">this</span>.year = date.getFullYear();</span><br><span class="line">    <span class="keyword">this</span>.month = date.getMonth() + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">this</span>.day = date.getDate();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>使用注入：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.controller(<span class="string">"control"</span>, (Today) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(Today.year);</span><br><span class="line">    <span class="built_in">console</span>.log(Today.month);</span><br><span class="line">    <span class="built_in">console</span>.log(Today.day);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h2 id="provider"><a href="#provider" class="headerlink" title="provider"></a>provider</h2><blockquote>
<p><code>provider</code> 是 <code>service</code> 的底层创建方式，可以理解 provider 是一个可配置版的 service，我们可以在正式注入 provider 前对 provider 进行一些参数的配置。</p>
</blockquote>
<p>定义：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> app = angular.module(<span class="string">"app"</span>, []);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里可以注入 $http 等 Provider</span></span><br><span class="line"><span class="comment">// 注意这里不可以使用 arrow function</span></span><br><span class="line"><span class="comment">// arrow function 不能作为 constructor</span></span><br><span class="line">app.provider(<span class="string">"Today"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">let</span> self = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.setDate = (year, month, day) =&gt; &#123;</span><br><span class="line">        <span class="keyword">this</span>.date = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month - <span class="number">1</span>, day);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.$get = () =&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            year: <span class="keyword">this</span>.date.getFullYear(),</span><br><span class="line">            month: <span class="keyword">this</span>.date.getMonth() + <span class="number">1</span>,</span><br><span class="line">            day: <span class="keyword">this</span>.date.getDate()</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>使用注入：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里重新配置了今天的日期是 2015年2月15日</span></span><br><span class="line"><span class="comment">// 注意这里注入的是 TodayProvider，使用驼峰命名来注入正确的需要配置的 provider</span></span><br><span class="line">app.config((TodayProvider) =&gt; &#123;</span><br><span class="line">    TodayProvider.setDate(<span class="number">2015</span>, <span class="number">2</span>, <span class="number">15</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.controller(<span class="string">"control"</span>, (Today) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(Today.year);</span><br><span class="line">    <span class="built_in">console</span>.log(Today.month);</span><br><span class="line">    <span class="built_in">console</span>.log(Today.day);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h1 id="handlebars-与-angular-符号解析冲突"><a href="#handlebars-与-angular-符号解析冲突" class="headerlink" title="handlebars 与 angular 符号解析冲突"></a>handlebars 与 angular 符号解析冲突</h1><p>场景：</p>
<blockquote>
<p>当我使用 node.js 作为服务端，而其中使用了 handlebars 作为模板引擎，当 node.js 对某 URL 进行相应并 render，由于其模板使用 <code>{ {} }</code> 作为变量解析符号。同样地，angular 也使用 <code>{ {} }</code> 作为变量解析符号，所以当 node.js 进行 render 页面后，如果 <code>{ {} }</code> 内的变量不存在，则该个区域会被清空，而我的原意是这个作为 angular 的解析所用，而不是 handlebars 使用，同时我也想继续使用 handlebars，那么此时就需要将 angular 默认的 <code>{ {} }</code> 解析符号重新定义。即使用依赖注入 <code>$interpolateProvider</code> 进行定义，如下示例：</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.config($interpolateProvider =&gt; &#123;</span><br><span class="line">    $interpolateProvider.startSymbol(<span class="string">'&#123;[&#123;'</span>);</span><br><span class="line">    $interpolateProvider.endSymbol(<span class="string">'&#125;]&#125;'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="ng-annotate-loader"><a href="#ng-annotate-loader" class="headerlink" title="ng-annotate-loader"></a>ng-annotate-loader</h1><blockquote>
<p><code>ng-annotate-loader</code> 应用于 webpack + angular 的开发场景，是用于解决 angular 在进行 JS 压缩后导致依赖注入失效并出现错误的解决方法</p>
</blockquote>
<p>安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install ng-annotate-loader --save-dev</span><br></pre></td></tr></table></figure></p>
<p>配置<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.js?$/</span>,</span><br><span class="line">    exclude: <span class="regexp">/(node_modules|bower_components)/</span>,</span><br><span class="line">    loader: <span class="string">'ng-annotate!babel?presets=es2015'</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<h1 id="双向数据绑定"><a href="#双向数据绑定" class="headerlink" title="双向数据绑定"></a>双向数据绑定</h1><blockquote>
<p>当我们使用非 Angular 自带的事件时，$scope 里的数据改变并不会引起 <code>$digest</code> 的 <code>dirty-checking</code> 循环，这将导致当 <code>model</code> 改变时，<code>view</code> 不会同步更新，这时我们需要自己主动触发更新</p>
</blockquote>
<p>HTML<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; foo &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"addBtn"</span>&gt;</span>go<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>JavaScript<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.controller(<span class="string">"control"</span>, ($scope) =&gt; &#123;</span><br><span class="line">    $scope.foo = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"addBtn"</span>).addEventListener(<span class="string">"click"</span>, () =&gt; &#123;</span><br><span class="line">        $scope.foo++;</span><br><span class="line">    &#125;, <span class="literal">false</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>很明显，示例的意图是当点击 button 时，<code>foo</code> 自增长并更新 View，但是实际上，$scope.foo 是改变了，但是 View 并不会刷新，这是因为 foo 并没有一个 $watch 检测变化后 $apply，最终引起 $digest，所以我们需要自己触发 $apply 或者创建一个 $watch 来触发或检测数据变化</p>
<p>JavaScript（使用 $apply）<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">app.controller(<span class="string">"control"</span>, ($scope) =&gt; &#123;</span><br><span class="line">    $scope.foo = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"addBtn"</span>).addEventListener(<span class="string">"click"</span>, () =&gt; &#123;</span><br><span class="line">        </span><br><span class="line">        $scope.$apply(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            $scope.foo++;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;, <span class="literal">false</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>JavaScript（使用 $watch &amp; $digest）<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">app.controller(<span class="string">"control"</span>, ($scope) =&gt; &#123;</span><br><span class="line">    $scope.foo = <span class="number">0</span>;</span><br><span class="line">    $scope.flag = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    $scope.$watch(<span class="string">"flag"</span>, (newValue, oldValue) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 当 $digest 循环检测 flag 时，如果新旧值不一致将调用该函数</span></span><br><span class="line">        $scope.foo = $scope.flag;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"addBtn"</span>).addEventListener(<span class="string">"click"</span>, () =&gt; &#123;</span><br><span class="line">       </span><br><span class="line">        $scope.flag++;</span><br><span class="line">        <span class="comment">// 主动触发 $digest 循环</span></span><br><span class="line">        $scope.$digest();</span><br><span class="line">    &#125;, <span class="literal">false</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h2 id="watch-watchExpression-listener-objectEquality"><a href="#watch-watchExpression-listener-objectEquality" class="headerlink" title="$watch(watchExpression, listener, [objectEquality])"></a>$watch(watchExpression, listener, [objectEquality])</h2><blockquote>
<p>注册一个 <code>listener</code> 回调函数，在每次 <code>watchExpression</code> 的值发生改变时调用</p>
</blockquote>
<ul>
<li><code>watchExpression</code> 在每次 <code>$digest</code> 执行时被调用，并返回要被检测的值（当多次输入同样的值时，<code>watchExpression</code> 不应该改变其自身的值，否则可能会引起多次的 $digest 循环，<code>watchExpression</code> 应该幂等）</li>
<li><code>listener</code> 将在当前 <code>watchExpression</code> 返回值和上次的 <code>watchExpression</code> 返回值不一致时被调用（使用 <code>!==</code> 来严格地判断不一致性，而不是使用 <code>==</code> 来判断，不过 <code>objectEquality == true</code> 除外）</li>
<li><code>objectEquality</code> 为 <code>boolean</code> 值，当为 <code>true</code> 时，将使用 <code>angular.equals</code> 来判断一致性，并使用 <code>angular.copy</code> 来保存此次的 Object 拷贝副本供给下一次的比较，这意味着复杂的对象检测将会有性能和内存上的问题</li>
</ul>
<h2 id="apply-exp"><a href="#apply-exp" class="headerlink" title="$apply([exp])"></a>$apply([exp])</h2><blockquote>
<p><code>$apply</code> 是 <code>$scope</code> 的一个函数，用于触发 <code>$digest</code> 循环</p>
</blockquote>
<p>$apply 伪代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">$apply</span>(<span class="params">expr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> $<span class="built_in">eval</span>(expr);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        $exceptionHandler(e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        $root.$digest();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>使用 <code>$eval(expr)</code> 执行 <code>expr</code> 表达式</li>
<li>如果在执行过程中跑出 exception，那么执行 $exceptionHandler(e)</li>
<li>最后无论结果，都会执行一次 <code>$digest</code> 循环</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/04/Webpack-Babel-使用-ES6-新特性/" itemprop="url">
                  webpack + Babel 使用 ES6 新特性
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-04T22:49:46+08:00" content="2016-05-04">
              2016-05-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/前端/ECMAScript-6/" itemprop="url" rel="index">
                    <span itemprop="name">ECMAScript 6</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/04/Webpack-Babel-使用-ES6-新特性/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/04/Webpack-Babel-使用-ES6-新特性/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>webpack 是一个模块加载器兼打包工具，Babel 是一款转码编译器，可以很方便地将 ES6、ES7 等当前浏览器不兼容的 JavaScript 新特性转码为 ES5 等当前浏览器普遍兼容的代码。将两者结合起来可以很方便地在项目中一边使用 ES6 编写代码，一边自动生成 ES5 代码</p>
</blockquote>
<h1 id="webpack-amp-Babel"><a href="#webpack-amp-Babel" class="headerlink" title="webpack &amp; Babel"></a>webpack &amp; Babel</h1><h2 id="安装-webpack"><a href="#安装-webpack" class="headerlink" title="安装 webpack"></a>安装 webpack</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack -g</span><br></pre></td></tr></table></figure>
<p>或者<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br><span class="line">npm install webpack --save-dev</span><br></pre></td></tr></table></figure></p>
<h2 id="安装-Babel-相关组件"><a href="#安装-Babel-相关组件" class="headerlink" title="安装 Babel 相关组件"></a>安装 Babel 相关组件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装加载器 babel-loader 和 Babel 的 API 代码 babel-core</span></span><br><span class="line">npm install --save-dev babel-loader babel-core</span><br><span class="line"><span class="comment"># 安装 ES2015（ES6）的代码，用于转码</span></span><br><span class="line">npm install babel-preset-es2015 --save-dev</span><br><span class="line"><span class="comment"># 用于转换一些 ES6 的新 API，如 Generator，Promise 等</span></span><br><span class="line">npm install --save babel-polyfill</span><br></pre></td></tr></table></figure>
<p>你可以在以下页面查看 JavaScript 的所需的转换代码模块进行按需安装<br><a href="http://babeljs.io/docs/plugins/preset-es2015/" target="_blank" rel="external">http://babeljs.io/docs/plugins/preset-es2015/</a></p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><blockquote>
<p>类似于 Grunt 和 Gulp，webpack 也有其特定地配置文件 <code>webpack.config.js</code></p>
</blockquote>
<p>如下配置使用babel：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: [</span><br><span class="line">        <span class="string">"babel-polyfill"</span>,</span><br><span class="line">        <span class="string">"./index.js"</span></span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: __dirname + <span class="string">'/output/'</span>,</span><br><span class="line">        publicPath: <span class="string">"/output/"</span>,</span><br><span class="line">        filename: <span class="string">'index.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        loaders: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.jsx?$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/(node_modules|bower_components)/</span>,</span><br><span class="line">                loader: <span class="string">'babel-loader'</span>, <span class="comment">// 'babel-loader' is also a legal name to reference</span></span><br><span class="line">                query: &#123;</span><br><span class="line">                    presets: [<span class="string">'es2015'</span>]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>entry——用于设置 webpack 执行打包文件的入口，是一个数组</li>
<li>output——用于指定生成文件的路径以及文件名等<ul>
<li>path——指定生成文件路径</li>
<li>publicPath——指定域名公共路径</li>
<li>filename——指定生成文件的名称</li>
</ul>
</li>
<li>module——主要用于配置 <code>loaders</code><ul>
<li>loaders——用于配置对应后缀的文件使用何种加载器进行处理<ul>
<li>test——使用正则表达式来指定某种特定的文件类型</li>
<li>exclude——排除某个文件夹下的文件进行处理</li>
<li>loader——指定相应的加载器，多个加载器使用 <code>!</code> 进行连接，每个 loader 都可以省略其后缀，如 <code>babel-loader</code> 可以写成 <code>babel</code></li>
<li>query——指定加载器的配置信息，也可以使用 <code>?</code> 直接连接在 <code>loader</code> 后面</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>以上只是涉及到我目前用到的一些配置信息的说明，更多的配置信息可以查阅官方文档，地址如下：<br><a href="https://webpack.github.io/docs/configuration.html" target="_blank" rel="external">https://webpack.github.io/docs/configuration.html</a></p>
<h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><p>在有 <code>webpack.config.js</code> 文件的目录下使用一下命令行：</p>
<ul>
<li><code>webpack</code>——直接启动 webpack，默认配置文件为 <code>webpack.config.js</code></li>
<li><code>webpack -w</code>——监测启动 webpack，实时打包更新文件</li>
<li><code>webpack -p</code>——对打包后的文件进行压缩</li>
</ul>
<p>更多的命令可以查看官方文档下的说明，地址如下：<br><a href="http://webpack.github.io/docs/cli.html" target="_blank" rel="external">http://webpack.github.io/docs/cli.html</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/24/ES6-学习笔记（七）/" itemprop="url">
                  ES6 学习笔记（七）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-24T15:19:08+08:00" content="2016-04-24">
              2016-04-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/前端/ECMAScript-6/" itemprop="url" rel="index">
                    <span itemprop="name">ECMAScript 6</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/24/ES6-学习笔记（七）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/24/ES6-学习笔记（七）/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h1><blockquote>
<p><code>Generator</code> 函数是ES6提供的一种异步编程解决方案，语法行为与传统函数完全不同</p>
</blockquote>
<h2 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里的 * 只要在 function 和函数名之间使用就可以</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">iterator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">"x"</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">"y"</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"z"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> iter = iterator();</span><br><span class="line"></span><br><span class="line">iter.next(); <span class="comment">// &#123;value: "x", done: false&#125;</span></span><br><span class="line">iter.next(); <span class="comment">// &#123;value: "y", done: false&#125;</span></span><br><span class="line">iter.next(); <span class="comment">// &#123;value: "z", done: true&#125;</span></span><br><span class="line">iter.next(); <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>
<p>调用 Generator 函数并不会如同普通函数一样返回函数的返回值，而是返回一个迭代器对象。<code>yield</code> 用于惰性执行 Generator 函数，当调用迭代器对象的 <code>next()</code> 时，就会执行函数内的代码知道遇到一个 <code>yield</code> 声明，并且其后面的值作为 <code>value</code> 的值返回，如果程序执行完毕，那么 <code>done</code> 是 <code>true</code>，反之是 <code>false</code></p>
<h2 id="next"><a href="#next" class="headerlink" title="next()"></a>next()</h2><p><code>next()</code> 是 Generator 函数的步骤执行的调用者，同时可以利用它来为函数内部注入值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">foo</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> y = <span class="number">2</span> * (<span class="keyword">yield</span> (x + <span class="number">1</span>));</span><br><span class="line">  <span class="keyword">var</span> z = <span class="keyword">yield</span> (y / <span class="number">3</span>);</span><br><span class="line">  <span class="keyword">return</span> (x + y + z);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = foo(<span class="number">5</span>);</span><br><span class="line">a.next() <span class="comment">// Object&#123;value:6, done:false&#125;</span></span><br><span class="line">a.next() <span class="comment">// Object&#123;value:NaN, done:false&#125;</span></span><br><span class="line">a.next() <span class="comment">// Object&#123;value:NaN, done:true&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 一开始 x 为 5，所以 yield 惰性求值返回为 6</span></span><br><span class="line"><span class="keyword">var</span> b = foo(<span class="number">5</span>);</span><br><span class="line">b.next() <span class="comment">// &#123; value:6, done:false &#125;</span></span><br><span class="line"><span class="comment">// 这里相当于声明上一个 yield 的返回值是 12，所以 y 等于 2*12</span></span><br><span class="line">b.next(<span class="number">12</span>) <span class="comment">// &#123; value:8, done:false &#125;</span></span><br><span class="line"><span class="comment">// 这里相当于声明上一个 yield 的返回值是 13，所以 z 等于 13</span></span><br><span class="line">b.next(<span class="number">13</span>) <span class="comment">// &#123; value:42, done:true &#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="使用-for…of"><a href="#使用-for…of" class="headerlink" title="使用 for…of"></a>使用 for…of</h2><p>由于 Generator 函数调用返回一个迭代器对象 ，那么他就可以被所有支持迭代器遍历的特性使用，例如 for…of</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">5</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">6</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> v <span class="keyword">of</span> foo()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1 2 3 4 5</span></span><br><span class="line"><span class="comment">// 由于当迭代器返回的 done 是 true 就停止遍历，所以 6 并不会被输出</span></span><br></pre></td></tr></table></figure>
<p>除了 for…of，<code>...</code>  运算符和 <code>Array.from()</code> 同样支持 Generator</p>
<h2 id="Generator-prototype-throw"><a href="#Generator-prototype-throw" class="headerlink" title="Generator.prototype.throw()"></a>Generator.prototype.throw()</h2><blockquote>
<p>Generator函数返回的遍历器对象，都有一个throw方法，可以在函数体外抛出错误，然后在Generator函数体内捕获</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> g = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">yield</span>;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'内部捕获'</span>, e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i = g();</span><br><span class="line">i.next();</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// 内部捕获后不再捕获此后的错误</span></span><br><span class="line">  i.throw(<span class="string">'a'</span>);</span><br><span class="line">  <span class="comment">// 内部不捕获，传递到外部</span></span><br><span class="line">  i.throw(<span class="string">'b'</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'外部捕获'</span>, e);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 内部捕获 a</span></span><br><span class="line"><span class="comment">// 外部捕获 b</span></span><br></pre></td></tr></table></figure>
<h2 id="Generator-prototype-return"><a href="#Generator-prototype-return" class="headerlink" title="Generator.prototype.return()"></a>Generator.prototype.return()</h2><blockquote>
<p>Generator函数返回的遍历器对象，还有一个return方法，可以返回给定的值，并且终结遍历Generator函数</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> g = gen();</span><br><span class="line"></span><br><span class="line">g.next()        <span class="comment">// &#123; value: 1, done: false &#125;</span></span><br><span class="line">g.return(<span class="string">'foo'</span>) <span class="comment">// &#123; value: "foo", done: true &#125;</span></span><br><span class="line">g.next()        <span class="comment">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="yield"><a href="#yield" class="headerlink" title="yield*"></a>yield*</h2><p><code>yield*</code> 用于在 Generator 函数内调用另一个 Generator 函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'x'</span>;</span><br><span class="line">  <span class="keyword">yield</span>* foo();</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'y'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'x'</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'a'</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'b'</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'y'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'x'</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> v <span class="keyword">of</span> foo()) &#123;</span><br><span class="line">    <span class="keyword">yield</span> v;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'y'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> v <span class="keyword">of</span> bar())&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// "x"</span></span><br><span class="line"><span class="comment">// "a"</span></span><br><span class="line"><span class="comment">// "b"</span></span><br><span class="line"><span class="comment">// "y"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 另外一个例子</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">inner</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'hello!'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">outer1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'open'</span>;</span><br><span class="line">  <span class="keyword">yield</span> inner();</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'close'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> gen = outer1()</span><br><span class="line">gen.next().value <span class="comment">// "open"</span></span><br><span class="line">gen.next().value <span class="comment">// 返回一个遍历器对象</span></span><br><span class="line">gen.next().value <span class="comment">// "close"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">outer2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'open'</span></span><br><span class="line">  <span class="keyword">yield</span>* inner()</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'close'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> gen = outer2()</span><br><span class="line">gen.next().value <span class="comment">// "open"</span></span><br><span class="line">gen.next().value <span class="comment">// "hello!"</span></span><br><span class="line">gen.next().value <span class="comment">// "close"</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Generator 函数的丰富超乎想象，这里写的笔记只是其冰山一角的特性，更多还是需要阅读相关书籍和资料<br>以上实例代码大部分来自阮一峰老师的 《ECMAScript 6 入门》 一书<br>书籍在线阅读地址: <a href="http://es6.ruanyifeng.com/#README" target="_blank" rel="external">http://es6.ruanyifeng.com/#README</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/23/ES6-学习笔记（六）/" itemprop="url">
                  ES6 学习笔记（六）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-23T22:13:41+08:00" content="2016-04-23">
              2016-04-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/前端/ECMAScript-6/" itemprop="url" rel="index">
                    <span itemprop="name">ECMAScript 6</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/23/ES6-学习笔记（六）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/23/ES6-学习笔记（六）/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Iterator"><a href="#Iterator" class="headerlink" title="Iterator"></a>Iterator</h1><blockquote>
<p>Iterator的作用有三个：一是为各种数据结构，提供一个统一的、简便的访问接口；二是使得数据结构的成员能够按某种次序排列；三是ES6创造了一种新的遍历命令for…of循环，Iterator接口主要供for…of消费</p>
</blockquote>
<h2 id="部署-Iterator-接口"><a href="#部署-Iterator-接口" class="headerlink" title="部署 Iterator 接口"></a>部署 Iterator 接口</h2><p>数组、Map、Set、类数组都有部署 Iterator 的接口，但是对象并没有，下面展示如何为对象部署 Iterator 接口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 第一种</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RangeIterator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(start, stop) &#123;</span><br><span class="line">    <span class="keyword">this</span>.value = start;</span><br><span class="line">    <span class="keyword">this</span>.stop = stop;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Symbol.Iterator 即部署接口</span></span><br><span class="line">  [<span class="built_in">Symbol</span>.iterator]() &#123; <span class="keyword">return</span> <span class="keyword">this</span>; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// next() 代表迭代器的指针运动逻辑</span></span><br><span class="line">  <span class="comment">// value 默认是当前值</span></span><br><span class="line">  <span class="comment">// done 表示当前值是否为末尾，布尔值</span></span><br><span class="line">  next() &#123;</span><br><span class="line">    <span class="keyword">var</span> value = <span class="keyword">this</span>.value;</span><br><span class="line">    <span class="keyword">if</span> (value &lt; <span class="keyword">this</span>.stop) &#123;</span><br><span class="line">      <span class="keyword">this</span>.value++;</span><br><span class="line">      <span class="keyword">return</span> &#123;done: <span class="literal">false</span>, value: value&#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;done: <span class="literal">true</span>, value: <span class="literal">undefined</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">range</span>(<span class="params">start, stop</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> RangeIterator(start, stop);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> value <span class="keyword">of</span> range(<span class="number">0</span>, <span class="number">3</span>)) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二种</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Obj</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.value = value;</span><br><span class="line">  <span class="keyword">this</span>.next = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Obj.prototype[<span class="built_in">Symbol</span>.iterator] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> iterator = &#123;</span><br><span class="line">    next: next</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> current = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (current)&#123;</span><br><span class="line">      <span class="keyword">var</span> value = current.value;</span><br><span class="line">      <span class="keyword">var</span> done = current === <span class="literal">null</span>;</span><br><span class="line">      current = current.next;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        done: done,</span><br><span class="line">        value: value</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        done: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> iterator;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> one = <span class="keyword">new</span> Obj(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">var</span> two = <span class="keyword">new</span> Obj(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">var</span> three = <span class="keyword">new</span> Obj(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">one.next = two;</span><br><span class="line">two.next = three;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">of</span> one)&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三种</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  data: [ <span class="string">'hello'</span>, <span class="string">'world'</span> ],</span><br><span class="line">  [<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">    <span class="keyword">const</span> self = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      next() &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; self.data.length) &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            value: self.data[index++],</span><br><span class="line">            done: <span class="literal">false</span></span><br><span class="line">          &#125;;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123; value: <span class="literal">undefined</span>, done: <span class="literal">true</span> &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>上面的三个例子都有一个共同点，就是部署 Iterator 接口都是在对象的 <code>Symbol.iterator</code> 属性中返回一个对象，而该对象包含一个 <code>next()</code> 函数指明指针的运动逻辑，并返回 <code>value</code> 和 <code>done</code> 两个值。还有另外一个 <code>return()</code> 方法用于在中断遍历时的操作，必须返回一个对象。此外，也可以直接使用数组的 Iterator 作为对象的迭代器</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> iterable = &#123;</span><br><span class="line">  <span class="number">0</span>: <span class="string">'a'</span>,</span><br><span class="line">  <span class="number">1</span>: <span class="string">'b'</span>,</span><br><span class="line">  <span class="number">2</span>: <span class="string">'c'</span>,</span><br><span class="line">  length: <span class="number">3</span>,</span><br><span class="line">  [<span class="built_in">Symbol</span>.iterator]: <span class="built_in">Array</span>.prototype[<span class="built_in">Symbol</span>.iterator]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> iterable) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item); <span class="comment">// 'a', 'b', 'c'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意，如果 <code>Symbol.iterator</code> 属性返回并不是一个迭代器的标准对象，那么会报错</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">obj[<span class="built_in">Symbol</span>.iterator] = () =&gt; <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">[...obj] <span class="comment">// TypeError: [] is not a function</span></span><br></pre></td></tr></table></figure>
<h2 id="Iterator-的使用场景"><a href="#Iterator-的使用场景" class="headerlink" title="Iterator 的使用场景"></a>Iterator 的使用场景</h2><h3 id="解构赋值"><a href="#解构赋值" class="headerlink" title="解构赋值"></a>解构赋值</h3><blockquote>
<p>对数组的解构赋值默认会调用 <code>Symbol.iterator</code> 方法</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>().add(<span class="string">'a'</span>).add(<span class="string">'b'</span>).add(<span class="string">'c'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [x,y] = set;</span><br><span class="line"><span class="comment">// x='a'; y='b'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [first, ...rest] = set;</span><br><span class="line"><span class="comment">// first='a'; rest=['b','c'];</span></span><br></pre></td></tr></table></figure>
<h3 id="扩展运算符"><a href="#扩展运算符" class="headerlink" title="扩展运算符"></a>扩展运算符</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">'hello'</span>;</span><br><span class="line">[...str] <span class="comment">//  ['h','e','l','l','o']</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 例二</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line">[<span class="string">'a'</span>, ...arr, <span class="string">'d'</span>]</span><br><span class="line"><span class="comment">// ['a', 'b', 'c', 'd']</span></span><br></pre></td></tr></table></figure>
<h3 id="yield"><a href="#yield" class="headerlink" title="yield*"></a>yield*</h3><blockquote>
<p>这个还没学到，不予评论，后面学到了再填坑</p>
</blockquote>
<h3 id="其他场景"><a href="#其他场景" class="headerlink" title="其他场景"></a>其他场景</h3><ul>
<li>for…of</li>
<li>Array.from()</li>
<li>Map(), Set(), WeakMap(), WeakSet()（比如new Map([[‘a’,1],[‘b’,2]])）</li>
<li>Promise.all()</li>
<li>Promise.race()</li>
<li>字符串也部署了 Iterator 接口</li>
</ul>
<h1 id="for…of"><a href="#for…of" class="headerlink" title="for…of"></a>for…of</h1><ul>
<li>for…of 遍历数组，key 值保持为数字，而 for…in 会把 key 值变为字符串</li>
<li>for…of 可以 break 或 return，而 forEach() 不可以</li>
<li>for…of 可以正确识别 32 位 UTF-16 字符</li>
</ul>
<blockquote>
<p>以上实例代码大部分来自阮一峰老师的 《ECMAScript 6 入门》 一书<br>书籍在线阅读地址: <a href="http://es6.ruanyifeng.com/#README" target="_blank" rel="external">http://es6.ruanyifeng.com/#README</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/21/ES6-学习笔记（五）/" itemprop="url">
                  ES6 学习笔记（五）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-21T13:57:05+08:00" content="2016-04-21">
              2016-04-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/前端/ECMAScript-6/" itemprop="url" rel="index">
                    <span itemprop="name">ECMAScript 6</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/21/ES6-学习笔记（五）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/21/ES6-学习笔记（五）/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h1><blockquote>
<p>Set 是一个类数组的数据结构，但是它的值都是独一无二的，并且它是一个构造函数</p>
</blockquote>
<p>Set 有以下几个特点</p>
<ul>
<li>值是不重复的</li>
<li>NaN 等于自身</li>
<li>添加值的时候不会进行类型转换，5 和 ‘5’ 是不一样的</li>
<li>可以接受一组数组进行初始化，会自动过滤重复的数</li>
<li>两个空对象不互相相等</li>
</ul>
<h2 id="Set-的方法"><a href="#Set-的方法" class="headerlink" title="Set 的方法"></a>Set 的方法</h2><ul>
<li>Set.prototype.constructor：构造函数，默认就是Set函数</li>
<li>Set.prototype.size：返回Set实例的成员总数</li>
<li><p>add(value)：添加某个值，返回Set结构本身，由于返回值的特点，可以链式调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s.add(<span class="number">1</span>).add(<span class="number">2</span>).add(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>delete(value)：删除某个值，返回一个布尔值，表示删除是否成功</p>
</li>
<li>has(value)：返回一个布尔值，表示该值是否为Set的成员</li>
<li>clear()：清除所有成员，没有返回值</li>
<li>keys()：返回一个键名的遍历器</li>
<li>values()：返回一个键值的遍历器</li>
<li>entries()：返回一个键值对的遍历器</li>
<li>forEach()：使用回调函数遍历每个成员</li>
</ul>
<h1 id="WeakSet"><a href="#WeakSet" class="headerlink" title="WeakSet"></a>WeakSet</h1><p>WeakSet 有以下几个特点</p>
<ul>
<li>加入成员只能是对象</li>
<li>成员都是弱引用，即垃圾回收机制不会因其引用对象而保持对象的存在</li>
<li>无法引用成员对象</li>
<li>无法变量成员对象</li>
</ul>
<h2 id="WeakSet-的方法"><a href="#WeakSet-的方法" class="headerlink" title="WeakSet 的方法"></a>WeakSet 的方法</h2><ul>
<li>WeakSet.prototype.add(value)：向WeakSet实例添加一个新成员</li>
<li>WeakSet.prototype.delete(value)：清除WeakSet实例的指定成员</li>
<li>WeakSet.prototype.has(value)：返回一个布尔值，表示某个值是否在WeakSet实例之中</li>
</ul>
<h1 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h1><blockquote>
<p>与对象的 key-value 结构类似的一种集合数据结构，不用的是 Map 可以使用任意一种类型的值作为 key，不会发生自动转换为字符串的情况</p>
</blockquote>
<ul>
<li>size：返回Map结构的成员总数</li>
<li>set(key, value)：设置key所对应的键值，然后返回整个Map结构。如果key已经有值，则键值会被更新，否则就新生成该键</li>
<li>get(key)：读取key对应的键值，如果找不到key，返回undefined</li>
<li>has(key)：返回一个布尔值，表示某个键是否在Map数据结构中</li>
<li>delete(key)：删除某个键，返回true。如果删除失败，返回false</li>
<li>clear()：清除所有成员，没有返回值</li>
</ul>
<h1 id="WeakMap"><a href="#WeakMap" class="headerlink" title="WeakMap"></a>WeakMap</h1><blockquote>
<p>与 WeakSet 的特点类似，不过这个相对于 Map 的数据结构的，只能使用 <code>get()</code>、<code>set()</code>、<code>has()</code>、<code>delete()</code></p>
<p>以上实例代码大部分来自阮一峰老师的 《ECMAScript 6 入门》 一书<br>书籍在线阅读地址: <a href="http://es6.ruanyifeng.com/#README" target="_blank" rel="external">http://es6.ruanyifeng.com/#README</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/20/ES6-学习笔记（四）/" itemprop="url">
                  ES6 学习笔记（四）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-20T09:26:29+08:00" content="2016-04-20">
              2016-04-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/前端/ECMAScript-6/" itemprop="url" rel="index">
                    <span itemprop="name">ECMAScript 6</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/20/ES6-学习笔记（四）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/20/ES6-学习笔记（四）/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="二进制数组"><a href="#二进制数组" class="headerlink" title="二进制数组"></a>二进制数组</h1><blockquote>
<p>二进制数组不是数组，只是类数组，二进制数组用于直接操作内存</p>
</blockquote>
<h2 id="ArrayBuffer-long"><a href="#ArrayBuffer-long" class="headerlink" title="ArrayBuffer(long)"></a>ArrayBuffer(long)</h2><blockquote>
<p><code>ArrayBuffer</code> 用于创建一段连续的内存地址，<code>long</code> 表示内存的长度（字节），但是不可以直接读写，只能通过 <code>视图</code> 读写，例如 <code>TypeArray</code>，<code>ArrayBuffer</code> 每个内存地址默认值都为 0。不同 <code>TypeArray</code> 操作同一组内存会互相影响</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> buf = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">32</span>);</span><br><span class="line"><span class="keyword">var</span> dataView = <span class="keyword">new</span> <span class="built_in">DataView</span>(buf);</span><br><span class="line">dataView.getUint8(<span class="number">0</span>) <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 操作同一组内存</span></span><br><span class="line"><span class="keyword">var</span> buffer = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">12</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x1 = <span class="keyword">new</span> <span class="built_in">Int32Array</span>(buffer);</span><br><span class="line">x1[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> x2 = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(buffer);</span><br><span class="line">x2[<span class="number">0</span>]  = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">x1[<span class="number">0</span>] <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<h3 id="Array-prototype-byteLength"><a href="#Array-prototype-byteLength" class="headerlink" title="Array.prototype.byteLength"></a>Array.prototype.byteLength</h3><blockquote>
<p>获取分配的内存字节长度</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> buffer = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">32</span>);</span><br><span class="line">buffer.byteLength</span><br><span class="line"><span class="comment">// 32</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(buffer.byteLength) &#123;</span><br><span class="line">    <span class="comment">// success</span></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// error</span></span><br><span class="line">    <span class="comment">// 分配的内存空间太大，可能存在没有那么大的内存空间而失败的情况</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Array-prototype-slice-start-end"><a href="#Array-prototype-slice-start-end" class="headerlink" title="Array.prototype.slice(start, end)"></a>Array.prototype.slice(start, end)</h3><blockquote>
<p>生成一段新的内存，拷贝 start 到 end-1 位置的内容到新的内存</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> buffer = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">8</span>);</span><br><span class="line"><span class="keyword">var</span> newBuffer = buffer.slice(<span class="number">0</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure>
<h3 id="ArrayBuffer-isView-buffer"><a href="#ArrayBuffer-isView-buffer" class="headerlink" title="ArrayBuffer.isView(buffer)"></a>ArrayBuffer.isView(buffer)</h3><blockquote>
<p>判断 buffer 是否是视图的实例化对象，该方法为 ArrayBuffer 的静态方法，直接调用</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> buffer = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">8</span>);</span><br><span class="line"><span class="built_in">ArrayBuffer</span>.isView(buffer) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> v = <span class="keyword">new</span> <span class="built_in">Int32Array</span>(buffer);</span><br><span class="line"><span class="built_in">ArrayBuffer</span>.isView(v) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h1 id="TypeArray"><a href="#TypeArray" class="headerlink" title="TypeArray"></a>TypeArray</h1><blockquote>
<p><code>TypeArray</code> 不是一个构造函数，而是一组构造函数，它包含 9 个不同的视图构造函数，都是类数组，都能用下标访问，都有 length 属性</p>
</blockquote>
<ul>
<li>Int8Array：8位有符号整数，长度1个字节。</li>
<li>Uint8Array：8位无符号整数，长度1个字节。</li>
<li>Uint8ClampedArray：8位无符号整数，长度1个字节，溢出处理不同。</li>
<li>Int16Array：16位有符号整数，长度2个字节。</li>
<li>Uint16Array：16位无符号整数，长度2个字节。</li>
<li>Int32Array：32位有符号整数，长度4个字节。</li>
<li>Uint32Array：32位无符号整数，长度4个字节。</li>
<li>Float32Array：32位浮点数，长度4个字节。</li>
<li>Float64Array：64位浮点数，长度8个字节。</li>
</ul>
<h2 id="TypedArray-buffer-byteOffset-length"><a href="#TypedArray-buffer-byteOffset-length" class="headerlink" title="TypedArray(buffer [, byteOffset [, length]])"></a>TypedArray(buffer [, byteOffset [, length]])</h2><blockquote>
<p>TypeArray 的构造函数可以传入三个参数</p>
</blockquote>
<ul>
<li>第一个参数，ArrayBuffer 的实例对象，必选</li>
<li>第二个参数，从 ArrayBuffer 的第 byteOffset 个字节开始读取，默认从 0 开始，注意，如果是 16 位的视图，需要是 2 的倍数，如果是 32 位 的视图，需要是 4 的倍数，以此类推，因为例如是 32 位的视图，那么该视图中 4 个字节为一个下标，为了完整读取内存，必须是每一个下标字节大小的整数倍，可选</li>
<li>第三个参数，读取 ArrayBuffer 的 length 个字节，默认读取到末尾，可选</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个8字节的ArrayBuffer</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个指向b的Int32视图，开始于字节0，直到缓冲区的末尾</span></span><br><span class="line"><span class="keyword">var</span> v1 = <span class="keyword">new</span> <span class="built_in">Int32Array</span>(b);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个指向b的Uint8视图，开始于字节2，直到缓冲区的末尾</span></span><br><span class="line"><span class="keyword">var</span> v2 = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(b, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个指向b的Int16视图，开始于字节2，长度为2</span></span><br><span class="line"><span class="keyword">var</span> v3 = <span class="keyword">new</span> <span class="built_in">Int16Array</span>(b, <span class="number">2</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<h2 id="TypeArray-length"><a href="#TypeArray-length" class="headerlink" title="TypeArray(length)"></a>TypeArray(length)</h2><blockquote>
<p>TypeArray 的构造函数还能直接通过分配内存创建视图</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f64a = <span class="keyword">new</span> <span class="built_in">Float64Array</span>(<span class="number">8</span>);</span><br><span class="line">f64a[<span class="number">0</span>] = <span class="number">10</span>;</span><br><span class="line">f64a[<span class="number">1</span>] = <span class="number">20</span>;</span><br><span class="line">f64a[<span class="number">2</span>] = f64a[<span class="number">0</span>] + f64a[<span class="number">1</span>];</span><br></pre></td></tr></table></figure>
<h2 id="TypeArray-typedArray"><a href="#TypeArray-typedArray" class="headerlink" title="TypeArray(typedArray)"></a>TypeArray(typedArray)</h2><blockquote>
<p>TypeArray 的构造函数能接受另外一个 TypeArray 的实例作为构造参数，新的实例是开辟了新的内存地址同时复制了相同的值，不会互相影响</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="keyword">new</span> <span class="built_in">Int8Array</span>([<span class="number">1</span>, <span class="number">1</span>]);</span><br><span class="line"><span class="keyword">var</span> y = <span class="keyword">new</span> <span class="built_in">Int8Array</span>(x);</span><br><span class="line">x[<span class="number">0</span>] <span class="comment">// 1</span></span><br><span class="line">y[<span class="number">0</span>] <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">x[<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line">y[<span class="number">0</span>] <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<h2 id="TypedArray-arrayLikeObject"><a href="#TypedArray-arrayLikeObject" class="headerlink" title="TypedArray(arrayLikeObject)"></a>TypedArray(arrayLikeObject)</h2><blockquote>
<p>TypeArray 的构造函数能接受一个类数组的参数，会开辟一段新的内存实例化视图</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="keyword">new</span> <span class="built_in">Int8Array</span>([<span class="number">1</span>, <span class="number">1</span>]);</span><br><span class="line"><span class="keyword">var</span> y = <span class="keyword">new</span> <span class="built_in">Int8Array</span>(x.buffer);</span><br><span class="line">x[<span class="number">0</span>] <span class="comment">// 1</span></span><br><span class="line">y[<span class="number">0</span>] <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">x[<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line">y[<span class="number">0</span>] <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<h2 id="数组方法"><a href="#数组方法" class="headerlink" title="数组方法"></a>数组方法</h2><blockquote>
<p>普通数组的方法对 TypeArray 也完全适用</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 缺少 contact 方法</span></span><br><span class="line">TypedArray.prototype.copyWithin(target, start[, end = <span class="keyword">this</span>.length])</span><br><span class="line">TypedArray.prototype.entries()</span><br><span class="line">TypedArray.prototype.every(callbackfn, thisArg?)</span><br><span class="line">TypedArray.prototype.fill(value, start=<span class="number">0</span>, end=<span class="keyword">this</span>.length)</span><br><span class="line">TypedArray.prototype.filter(callbackfn, thisArg?)</span><br><span class="line">TypedArray.prototype.find(predicate, thisArg?)</span><br><span class="line">TypedArray.prototype.findIndex(predicate, thisArg?)</span><br><span class="line">TypedArray.prototype.forEach(callbackfn, thisArg?)</span><br><span class="line">TypedArray.prototype.indexOf(searchElement, fromIndex=<span class="number">0</span>)</span><br><span class="line">TypedArray.prototype.join(separator)</span><br><span class="line">TypedArray.prototype.keys()</span><br><span class="line">TypedArray.prototype.lastIndexOf(searchElement, fromIndex?)</span><br><span class="line">TypedArray.prototype.map(callbackfn, thisArg?)</span><br><span class="line">TypedArray.prototype.reduce(callbackfn, initialValue?)</span><br><span class="line">TypedArray.prototype.reduceRight(callbackfn, initialValue?)</span><br><span class="line">TypedArray.prototype.reverse()</span><br><span class="line">TypedArray.prototype.slice(start=<span class="number">0</span>, end=<span class="keyword">this</span>.length)</span><br><span class="line">TypedArray.prototype.some(callbackfn, thisArg?)</span><br><span class="line">TypedArray.prototype.sort(comparefn)</span><br><span class="line">TypedArray.prototype.toLocaleString(reserved1?, reserved2?)</span><br><span class="line">TypedArray.prototype.toString()</span><br><span class="line">TypedArray.prototype.values()</span><br></pre></td></tr></table></figure>
<h2 id="小端字节序"><a href="#小端字节序" class="headerlink" title="小端字节序"></a>小端字节序</h2><blockquote>
<p>如果使用一个 32 位的视图读取并修改一段内存后，再使用一个 16 位的视图读取该段内存缓冲时，其长度应该是 32 位视图的两倍，这时候 16 位视图中的数据存放就会出现一个现象，跟字节排放的规则相关，看示例</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> buffer = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(<span class="number">16</span>);</span><br><span class="line"><span class="keyword">var</span> int32View = <span class="keyword">new</span> <span class="built_in">Int32Array</span>(buffer);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; int32View.length; i++) &#123;</span><br><span class="line">  int32View[i] = i * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(int32View); <span class="comment">// [0, 2, 4, 6]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> int16View = <span class="keyword">new</span> <span class="built_in">Int16Array</span>(buffer);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(int16View); <span class="comment">// [0, 0, 2, 0, 4, 0, 6, 0]</span></span><br></pre></td></tr></table></figure>
<p>由于 32 位视图是 4 个字节存放一个数据，16 位视图是 2 个字节存放一个数据，那么 16 位视图明显要使用 2 个数据位来存放一个 32 位视图的数据，而之所以 16 位视图都是两个数据位的第一个数据位显示为正确数据，第二个显示为 0，这就涉及现代计算机都采用了小端字节序的规则在内存中存放数据的原因，而 TypeArray 也是采用该种策略。小端字节序简略地说就是从后往前一个字节一个字节地存放数据到内存的每个地址中，更详细的解释可以参考：<a href="http://blog.csdn.net/ce123/article/details/6971544" target="_blank" rel="external">http://blog.csdn.net/ce123/article/details/6971544</a> 小端字节序也导致了 TypeArray 无法正确读取大端字节序的内容</p>
<h2 id="TypeArray-prototype-BYTES-PER-ELEMENT"><a href="#TypeArray-prototype-BYTES-PER-ELEMENT" class="headerlink" title="TypeArray.prototype.BYTES_PER_ELEMENT"></a>TypeArray.prototype.BYTES_PER_ELEMENT</h2><blockquote>
<p>用于输出每一个 TypeArray 类型视图的每一位所占的字节数</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Int8Array</span>.BYTES_PER_ELEMENT <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">Uint8Array</span>.BYTES_PER_ELEMENT <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">Int16Array</span>.BYTES_PER_ELEMENT <span class="comment">// 2</span></span><br><span class="line"><span class="built_in">Uint16Array</span>.BYTES_PER_ELEMENT <span class="comment">// 2</span></span><br><span class="line"><span class="built_in">Int32Array</span>.BYTES_PER_ELEMENT <span class="comment">// 4</span></span><br><span class="line"><span class="built_in">Uint32Array</span>.BYTES_PER_ELEMENT <span class="comment">// 4</span></span><br><span class="line"><span class="built_in">Float32Array</span>.BYTES_PER_ELEMENT <span class="comment">// 4</span></span><br><span class="line"><span class="built_in">Float64Array</span>.BYTES_PER_ELEMENT <span class="comment">// 8</span></span><br></pre></td></tr></table></figure>
<h2 id="溢出"><a href="#溢出" class="headerlink" title="溢出"></a>溢出</h2><blockquote>
<p>TypeArray 对于溢出的处理就是直接抛弃溢出的位</p>
</blockquote>
<ul>
<li>正向溢出（overflow）：当输入值大于当前数据类型的最大值，结果等于当前数据类型的最小值加上余值，再减去1</li>
<li>负向溢出（underflow）：当输入值小于当前数据类型的最小值，结果等于当前数据类型的最大值减去余值，再加上1</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> int8 = <span class="keyword">new</span> <span class="built_in">Int8Array</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">int8[<span class="number">0</span>] = <span class="number">128</span>;</span><br><span class="line">int8[<span class="number">0</span>] <span class="comment">// -128</span></span><br><span class="line"></span><br><span class="line">int8[<span class="number">0</span>] = <span class="number">-129</span>;</span><br><span class="line">int8[<span class="number">0</span>] <span class="comment">// 127</span></span><br></pre></td></tr></table></figure>
<h2 id="其他方法"><a href="#其他方法" class="headerlink" title="其他方法"></a>其他方法</h2><ul>
<li>TypedArray.prototype.buffer，返回视图整段内存引用</li>
<li>TypedArray.prototype.byteLength，返回视图的内存字节长度</li>
<li>TypedArray.prototype.byteOffset，返回视图从内存第几个字节开始引用</li>
<li>TypedArray.prototype.length，返回视图的成员长度，与其每个成员占用字节数相关</li>
<li>TypedArray.prototype.set(typeArray[, startIndex])，将一段内存完全复制到另一端内存中</li>
<li>TypedArray.prototype.subarray(startIndex, endIndex)，从一个视图上截取一部分创建为一个新的视图</li>
<li>TypedArray.prototype.slice(index)，从一个视图上截取一段创建一个新的视图，index 可以为负数，表示倒数</li>
<li>TypedArray.of()，将参数创建为一个新的视图</li>
<li>TypedArray.from(arrayLike[, callback])，将 arrayLike 转化为一个相应的可遍历的视图类型，callback 的功能类似于数组的 map 功能</li>
</ul>
<h1 id="DataView"><a href="#DataView" class="headerlink" title="DataView"></a>DataView</h1><blockquote>
<p>DataView 可以自行设置大端字节序或者小端字节序，同时有 8 个获取数据的方法和 8 个设置数据的方法</p>
</blockquote>
<ul>
<li>getInt8：读取1个字节，返回一个8位整数。</li>
<li>getUint8：读取1个字节，返回一个无符号的8位整数。</li>
<li>getInt16：读取2个字节，返回一个16位整数。</li>
<li>getUint16：读取2个字节，返回一个无符号的16位整数。</li>
<li>getInt32：读取4个字节，返回一个32位整数。</li>
<li>getUint32：读取4个字节，返回一个无符号的32位整数。</li>
<li>getFloat32：读取4个字节，返回一个32位浮点数。</li>
<li>getFloat64：读取8个字节，返回一个64位浮点数。</li>
</ul>
<p>这 8 个方法都传入一个正整数表示从第几个字节开始读取，第二个参数为一个布尔值，true 代表使用小端字节序，false 代表使用大端字节序，默认为大端字节序</p>
<ul>
<li>setInt8：写入1个字节的8位整数。</li>
<li>setUint8：写入1个字节的8位无符号整数。</li>
<li>setInt16：写入2个字节的16位整数。</li>
<li>setUint16：写入2个字节的16位无符号整数。</li>
<li>setInt32：写入4个字节的32位整数。</li>
<li>setUint32：写入4个字节的32位无符号整数。</li>
<li>setFloat32：写入4个字节的32位浮点数。</li>
<li>setFloat64：写入8个字节的64位浮点数。</li>
</ul>
<p>这 8 个方法都可以传入三个参数，第一个表示从第几个字节写入数据，第二个表示写入数据的内容，第三个指定大小端字节序</p>
<h1 id="其他一些新特性"><a href="#其他一些新特性" class="headerlink" title="其他一些新特性"></a>其他一些新特性</h1><h2 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a>AJAX</h2><blockquote>
<p>AJAX 可以设置 <code>responseType</code> 为 <code>arraybuffer</code> 明确指定响应数据位二进制数据，如果不明确，可以设置为 <code>blod</code></p>
</blockquote>
<h2 id="Canvas"><a href="#Canvas" class="headerlink" title="Canvas"></a>Canvas</h2><blockquote>
<p>Canvas 使用 <code>Uint8ClampedArray</code> 读取二进制像素数据，该 TypeArray 可以自动过滤高位溢出，取值范围始终为 0-255</p>
</blockquote>
<h2 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h2><blockquote>
<p>WebSocket 可以发送二进制数据</p>
</blockquote>
<h2 id="Fetch-API"><a href="#Fetch-API" class="headerlink" title="Fetch API"></a>Fetch API</h2><blockquote>
<p>Fetch API取回的数据，就是 <code>ArrayBuffer</code> 对象</p>
</blockquote>
<h2 id="File-API"><a href="#File-API" class="headerlink" title="File API"></a>File API</h2><blockquote>
<p>File API 可以将文件数据作为二进制的 <code>ArrayBuffer</code> 类型读取处理</p>
<p>以上实例代码大部分来自阮一峰老师的 《ECMAScript 6 入门》 一书<br>书籍在线阅读地址: <a href="http://es6.ruanyifeng.com/#README" target="_blank" rel="external">http://es6.ruanyifeng.com/#README</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/18/ES6-学习笔记（三）/" itemprop="url">
                  ES6 学习笔记（三）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-18T16:21:39+08:00" content="2016-04-18">
              2016-04-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/前端/ECMAScript-6/" itemprop="url" rel="index">
                    <span itemprop="name">ECMAScript 6</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/18/ES6-学习笔记（三）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/18/ES6-学习笔记（三）/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol"></a>Symbol</h1><blockquote>
<p><code>Symbol</code> 是 JavaScript 的第七种类型（前六种是：Undefined、Null、布尔值（Boolean）、字符串（String）、数值（Number）、对象（Object））。它用于生成独一无二的变量名，防止相同变量名的相互覆盖，例如在对象中，用字符串声明的属性如果相同，那么会互相覆盖</p>
</blockquote>
<p>注意点：</p>
<ul>
<li>Symbol 不能与其他值一起计算，例如与字符串连接，但是可以使用 <code>toString()</code> 进行转换</li>
<li>Symbol 不能使用点运算符作为属性名，只能使用方括号，避免与字符串方式冲突</li>
<li>Symbol 作为属性名，该属性不会出现在 for…in、for…of 循环中，也不会被 Object.keys()、Object.getOwnPropertyNames() 返回</li>
<li>Symbol 可以被 Object.getOwnPropertySymbols() 返回</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s1 = <span class="built_in">Symbol</span>(<span class="string">'foo'</span>);</span><br><span class="line"><span class="keyword">var</span> s2 = <span class="built_in">Symbol</span>(<span class="string">'bar'</span>);</span><br><span class="line"><span class="keyword">var</span> s3 = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="keyword">var</span> s4 = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="keyword">var</span> s5 = <span class="built_in">Symbol</span>(<span class="string">'foo'</span>);</span><br><span class="line"></span><br><span class="line">s1 <span class="comment">// Symbol(foo)</span></span><br><span class="line">s2 <span class="comment">// Symbol(bar)</span></span><br><span class="line"></span><br><span class="line">s3 === s4; <span class="comment">// false</span></span><br><span class="line">s1 === s5; <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">s1.toString() <span class="comment">// "Symbol(foo)"</span></span><br><span class="line">s2.toString() <span class="comment">// "Symbol(bar)"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mySymbol = <span class="built_in">Symbol</span>();</span><br><span class="line"><span class="keyword">var</span> a = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">a.mySymbol = <span class="string">'Hello!'</span>;</span><br><span class="line">a[mySymbol] <span class="comment">// undefined</span></span><br><span class="line">a[<span class="string">'mySymbol'</span>] <span class="comment">// "Hello!"</span></span><br></pre></td></tr></table></figure>
<h2 id="Symbol-for-amp-Symbol-keyFor"><a href="#Symbol-for-amp-Symbol-keyFor" class="headerlink" title="Symbol.for() &amp; Symbol.keyFor()"></a>Symbol.for() &amp; Symbol.keyFor()</h2><blockquote>
<p><code>Symbol.for(name)</code> 与 <code>Symbol(name)</code> 不同的地方在于，前者在没有存在 name 注册的 Symbol 变量时，会注册一个新的 Symbol 变量，如果存在，那么就会返回该 name 注册的 Symbol。后者不管 name 有没有注册过，都会产生一个新的 Symbol</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s1 = <span class="built_in">Symbol</span>.for(<span class="string">'foo'</span>);</span><br><span class="line"><span class="keyword">var</span> s2 = <span class="built_in">Symbol</span>.for(<span class="string">'foo'</span>);</span><br><span class="line"></span><br><span class="line">s1 === s2 <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Symbol</span>.for(<span class="string">"bar"</span>) === <span class="built_in">Symbol</span>.for(<span class="string">"bar"</span>)</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Symbol</span>(<span class="string">"bar"</span>) === <span class="built_in">Symbol</span>(<span class="string">"bar"</span>)</span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>Symbol.keyFor(Symbol)</code> 会返回已注册过的 Symbol 的值的 desc</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s1 = <span class="built_in">Symbol</span>.for(<span class="string">"foo"</span>);</span><br><span class="line"><span class="built_in">Symbol</span>.keyFor(s1) <span class="comment">// "foo"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s2 = <span class="built_in">Symbol</span>(<span class="string">"foo"</span>);</span><br><span class="line"><span class="built_in">Symbol</span>.keyFor(s2) <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<h1 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h1><blockquote>
<p>Proxy用于修改某些操作的默认行为，等同于在语言层面做出修改，所以属于一种“元编程”（meta programming），即对编程语言进行编程</p>
</blockquote>
<h2 id="new-Proxy-target-handler"><a href="#new-Proxy-target-handler" class="headerlink" title="new Proxy(target, handler)"></a>new Proxy(target, handler)</h2><blockquote>
<p>target 为要通过 handler 进行处理拦截的对象</p>
</blockquote>
<h2 id="get"><a href="#get" class="headerlink" title="get()"></a>get()</h2><blockquote>
<p>用于拦截对对象属性访问时的处理</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">  name: <span class="string">"张三"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(person, &#123;</span><br><span class="line">  get: <span class="function"><span class="keyword">function</span>(<span class="params">target, property</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (property <span class="keyword">in</span> target) &#123;</span><br><span class="line">      <span class="keyword">return</span> target[property];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">ReferenceError</span>(<span class="string">"Property \""</span> + property + <span class="string">"\" does not exist."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">proxy.name <span class="comment">// "张三"</span></span><br><span class="line">proxy.age <span class="comment">// 抛出一个错误</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对数组负数的索引值进行处理</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createArray</span>(<span class="params">...elements</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> handler = &#123;</span><br><span class="line">    get(target, propKey, receiver) &#123;</span><br><span class="line">      <span class="keyword">let</span> index = <span class="built_in">Number</span>(propKey);</span><br><span class="line">      <span class="keyword">if</span> (index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        propKey = <span class="built_in">String</span>(target.length + index);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, propKey, receiver);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> target = [];</span><br><span class="line">  target.push(...elements);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, handler);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = createArray(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>);</span><br><span class="line">arr[<span class="number">-1</span>] <span class="comment">// c</span></span><br></pre></td></tr></table></figure>
<h2 id="set"><a href="#set" class="headerlink" title="set()"></a>set()</h2><blockquote>
<p>用于拦截设置属性时的操作</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> validator = &#123;</span><br><span class="line">  set: <span class="function"><span class="keyword">function</span>(<span class="params">obj, prop, value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (prop === <span class="string">'age'</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="built_in">Number</span>.isInteger(value)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'The age is not an integer'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (value &gt; <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RangeError</span>(<span class="string">'The age seems invalid'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对于age以外的属性，直接保存</span></span><br><span class="line">    obj[prop] = value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person = <span class="keyword">new</span> <span class="built_in">Proxy</span>(&#123;&#125;, validator);</span><br><span class="line"></span><br><span class="line">person.age = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">person.age <span class="comment">// 100</span></span><br><span class="line">person.age = <span class="string">'young'</span> <span class="comment">// 报错</span></span><br><span class="line">person.age = <span class="number">300</span> <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure>
<h2 id="apply-target-context-args"><a href="#apply-target-context-args" class="headerlink" title="apply(target, context, args)"></a>apply(target, context, args)</h2><blockquote>
<p>用于拦截函数的调用、call和apply操作。target 为目标函数，context 为函数执行上下文，args 为函数参数</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> target = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="string">'I am the target'</span>; &#125;;</span><br><span class="line"><span class="keyword">var</span> handler = &#123;</span><br><span class="line">  apply: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'I am the proxy'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, handler);</span><br><span class="line"></span><br><span class="line">p()</span><br><span class="line"><span class="comment">// "I am the proxy"</span></span><br></pre></td></tr></table></figure>
<h2 id="has"><a href="#has" class="headerlink" title="has()"></a>has()</h2><blockquote>
<p>用于处理一些在执行 “xxx in obj” 的拦截，可以对某些属性进行隐藏</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> handler = &#123;</span><br><span class="line">  has (target, key) &#123;</span><br><span class="line">    <span class="keyword">if</span> (key[<span class="number">0</span>] === <span class="string">'_'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> key <span class="keyword">in</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> target = &#123; _prop: <span class="string">'foo'</span>, prop: <span class="string">'foo'</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, handler);</span><br><span class="line"><span class="string">'_prop'</span> <span class="keyword">in</span> proxy <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h2 id="construct"><a href="#construct" class="headerlink" title="construct()"></a>construct()</h2><blockquote>
<p>用于拦截 new 操作时的处理</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="built_in">Proxy</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;, &#123;</span><br><span class="line">  construct: <span class="function"><span class="keyword">function</span>(<span class="params">target, args</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'called: '</span> + args.join(<span class="string">', '</span>));</span><br><span class="line">    <span class="keyword">return</span> &#123; value: args[<span class="number">0</span>] * <span class="number">10</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> p(<span class="number">1</span>).value</span><br><span class="line"><span class="comment">// "called: 1"</span></span><br><span class="line"><span class="comment">// 10</span></span><br></pre></td></tr></table></figure>
<h2 id="deleteProperty"><a href="#deleteProperty" class="headerlink" title="deleteProperty()"></a>deleteProperty()</h2><blockquote>
<p>用于拦截删除对象属性时的操作</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> handler = &#123;</span><br><span class="line">  deleteProperty (target, key) &#123;</span><br><span class="line">    invariant(key, <span class="string">'delete'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">invariant</span> (<span class="params">key, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (key[<span class="number">0</span>] === <span class="string">'_'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Invalid attempt to <span class="subst">$&#123;action&#125;</span> private "<span class="subst">$&#123;key&#125;</span>" property`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> target = &#123; _prop: <span class="string">'foo'</span> &#125;</span><br><span class="line"><span class="keyword">var</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, handler)</span><br><span class="line"><span class="keyword">delete</span> proxy._prop; <span class="comment">// 报错</span></span><br></pre></td></tr></table></figure>
<h2 id="defineProperty"><a href="#defineProperty" class="headerlink" title="defineProperty()"></a>defineProperty()</h2><blockquote>
<p>用于拦截定义对象属性时的操作</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> handler = &#123;</span><br><span class="line">  defineProperty (target, key, descriptor) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> target = &#123;&#125;</span><br><span class="line"><span class="keyword">var</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, handler)</span><br><span class="line">proxy.foo = <span class="string">'bar'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(proxy.foo); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<h2 id="enumerate"><a href="#enumerate" class="headerlink" title="enumerate()"></a>enumerate()</h2><blockquote>
<p>用于拦截 “for xxx in obj” 时的处理操作，跟 has() 不是同种拦截，互不影响</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这个例子在 FF 上成功，但是 Chrome 上依旧打印了所有属性</span></span><br><span class="line"><span class="keyword">var</span> handler = &#123;</span><br><span class="line">  enumerate (target) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.keys(target).filter(key =&gt; key[<span class="number">0</span>] !== <span class="string">'_'</span>)[<span class="built_in">Symbol</span>.iterator]();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> target = &#123; prop: <span class="string">'foo'</span>, _bar: <span class="string">'baz'</span>, _prop: <span class="string">'foo'</span> &#125;</span><br><span class="line"><span class="keyword">var</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, handler)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> proxy) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(key);</span><br><span class="line">  <span class="comment">// "prop"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Reflect"><a href="#Reflect" class="headerlink" title="Reflect"></a>Reflect</h1><blockquote>
<p>Reflect 对象提供了若干个能对任意对象进行某种特定的可拦截操作（interceptable operation）的方法，它所提供的静态方法在 Proxy 中都有对应的相同方法，可以这么说，Reflect 保留了原先的默认处理方式，以供 Proxy 在修改默认处理的同时也能应用默认处理后再进行一些其他处理。某些方法也是 Object 上的方法，不过修改相应的返回值，更加完善<br>参考资料：<br><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect" target="_blank" rel="external">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect</a></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 老写法</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(target, property, attributes);</span><br><span class="line">  <span class="comment">// success</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="comment">// failure</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新写法</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">Reflect</span>.defineProperty(target, property, attributes)) &#123;</span><br><span class="line">  <span class="comment">// success</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// failure</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 老写法</span></span><br><span class="line"><span class="string">'assign'</span> <span class="keyword">in</span> <span class="built_in">Object</span> <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 新写法</span></span><br><span class="line"><span class="comment">// 行为被函数化</span></span><br><span class="line"><span class="built_in">Reflect</span>.has(<span class="built_in">Object</span>, <span class="string">'assign'</span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加了自己的行为，同时使用 Reflect 的相应静态方法执行默认行为</span></span><br><span class="line"><span class="keyword">var</span> loggedObj = <span class="keyword">new</span> <span class="built_in">Proxy</span>(obj, &#123;</span><br><span class="line">  get(target, name) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'get'</span>, target, name);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, name);</span><br><span class="line">  &#125;,</span><br><span class="line">  deleteProperty(target, name) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'delete'</span> + name);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.deleteProperty(target, name);</span><br><span class="line">  &#125;,</span><br><span class="line">  has(target, name) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'has'</span> + name);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.has(target, name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可能有人会对 Reflect 的存在感到疑惑，我个人认为 Reflect 存在的意义大概有两点，一是对 ES5 中 Object 一些方法的返回值进行修改完善，但是为了兼容性，开拓了一个新的对象来存放这些静态方法。二是为了让 Proxy 可以方便地在拦截器中添加处理方法的同时调用默认处理方法，所以 Reflect 中存在的静态方法都跟 Proxy 中的方法一一对应，同时修改了部分 Object 中的方法的返回值，例如 Object 中一些调用失败的方法会抛出错误，而在 Reflect 中修改为返回布尔值，以上是一点点见解，可以参考一下：<a href="https://tc39.github.io/ecma262/#sec-reflect-object" target="_blank" rel="external">https://tc39.github.io/ecma262/#sec-reflect-object</a></p>
<p>以上实例代码大部分来自阮一峰老师的 《ECMAScript 6 入门》 一书<br>书籍在线阅读地址: <a href="http://es6.ruanyifeng.com/#README" target="_blank" rel="external">http://es6.ruanyifeng.com/#README</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/me.jpg"
               alt="滨滨和泓泓" />
          <p class="site-author-name" itemprop="name">滨滨和泓泓</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">28</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/rlilyyy" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/1883893572" target="_blank">
                  
                    <i class="fa fa-weibo"></i> Weibo
                  
                </a>
              </span>
            
          
        </div>

        
        

        
        <div class="links-of-blogroll motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">滨滨和泓泓</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  


  




<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=0.5.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"rlilyyy"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
      <script src="/vendors/ua-parser-js/dist/ua-parser.min.js"></script>
      <script src="/js/src/hook-duoshuo.js"></script>
    
  





  
  
  

  


</body>
>>>>>>> b8223f1593129e819880508fa368e8b3ce0cbfb2
</html>
